<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>../bb/lib/pagelet/list.js - ose-bundle</title>
  <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
  <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
  <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
  <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/zepto/1.1.4/zepto.min.js"></script>
</head>
<body class="yui3-skin-sam">

  <div id="doc">
    <div class="yui3-g">

      <div id="sidebar" class="yui3-u">
        <a href="../index.html"><h2>OSE documentation</h2></a>

        <div class="sidebox">
          <div class="hd">
            <h2 class="no-toc">Type to filter sidebar:</h2>
          </div>
          <div class="bd">
            <input id="filter-input" />
          </div>
        </div>

        







<div id="modules" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">All packages and components</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../modules/bb.html">bb</a>
                
                    <ul>
                        
                            <li><a href="../modules/bb.box.html">bb.box</a></li>
                        
                            <li><a href="../modules/bb.dialog.html">bb.dialog</a></li>
                        
                            <li><a href="../modules/bb.pagelet.html">bb.pagelet</a></li>
                        
                            <li><a href="../modules/bb.widget.html">bb.widget</a></li>
                        
                            <li><a href="../modules/bb.stateObj.html">bb.stateObj</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/boards.html">boards</a>
                
                </li>
            
                <li><a href="../modules/bundle.html">bundle</a>
                
                    <ul>
                        
                            <li><a href="../modules/bundle.lirc.html">bundle.lirc</a></li>
                        
                            <li><a href="../modules/bundle.media.html">bundle.media</a></li>
                        
                            <li><a href="../modules/bundle.rpi.html">bundle.rpi</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/control.html">control</a>
                
                    <ul>
                        
                            <li><a href="../modules/control.distributor.html">control.distributor</a></li>
                        
                            <li><a href="../modules/control.pin.html">control.pin</a></li>
                        
                            <li><a href="../modules/control.room.html">control.room</a></li>
                        
                            <li><a href="../modules/control.remote.html">control.remote</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/dvb.html">dvb</a>
                
                </li>
            
                <li><a href="../modules/fs.html">fs</a>
                
                </li>
            
                <li><a href="../modules/icecast.html">icecast</a>
                
                </li>
            
                <li><a href="../modules/lirc.html">lirc</a>
                
                </li>
            
                <li><a href="../modules/media.html">media</a>
                
                    <ul>
                        
                            <li><a href="../modules/media.history.html">media.history</a></li>
                        
                            <li><a href="../modules/media.player.html">media.player</a></li>
                        
                            <li><a href="../modules/media.stream.html">media.stream</a></li>
                        
                            <li><a href="../modules/media.source.html">media.source</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/ose.html">ose</a>
                
                    <ul>
                        
                            <li><a href="../modules/ose.data.html">ose.data</a></li>
                        
                            <li><a href="../modules/ose.http.html">ose.http</a></li>
                        
                            <li><a href="../modules/ose.peer.html">ose.peer</a></li>
                        
                            <li><a href="../modules/ose.link.html">ose.link</a></li>
                        
                            <li><a href="../modules/ose.logger.html">ose.logger</a></li>
                        
                            <li><a href="../modules/ose.plugin.html">ose.plugin</a></li>
                        
                            <li><a href="../modules/ose.wrap.html">ose.wrap</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/pa.html">pa</a>
                
                </li>
            
                <li><a href="../modules/rpi.html">rpi</a>
                
                </li>
            
                <li><a href="../modules/videolan.html">videolan</a>
                
                </li>
            
                <li><a href="../modules/xorg.html">xorg</a>
                
                </li>
            
                <li><a href="../modules/yoctopuce.html">yoctopuce</a>
                
                </li>
            
                <li><a href="../modules/youtube.html">youtube</a>
                
                </li>
            
        </ul>
    </div>
</div>

<div id="classes" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">All modules</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../classes/bb.content.html">bb.content</a></li>
            
                <li><a href="../classes/bb.lib.html">bb.lib</a></li>
            
                <li><a href="../classes/bb.lib.box.content.html">bb.lib.box.content</a></li>
            
                <li><a href="../classes/bb.lib.box.left.html">bb.lib.box.left</a></li>
            
                <li><a href="../classes/bb.lib.dialog.html">bb.lib.dialog</a></li>
            
                <li><a href="../classes/bb.lib.dialog.action.html">bb.lib.dialog.action</a></li>
            
                <li><a href="../classes/bb.lib.dialog.confirm.html">bb.lib.dialog.confirm</a></li>
            
                <li><a href="../classes/bb.lib.dialog.info.html">bb.lib.dialog.info</a></li>
            
                <li><a href="../classes/bb.lib.dialog.valueSelector.html">bb.lib.dialog.valueSelector</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.html">bb.lib.pagelet</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.dashboard.html">bb.lib.pagelet.dashboard</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.detail.html">bb.lib.pagelet.detail</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.entry.html">bb.lib.pagelet.entry</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.gesture.html">bb.lib.pagelet.gesture</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.list.html">bb.lib.pagelet.list</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.listItem.html">bb.lib.pagelet.listItem</a></li>
            
                <li><a href="../classes/bb.lib.widget.html">bb.lib.widget</a></li>
            
                <li><a href="../classes/bb.lib.widget.button.html">bb.lib.widget.button</a></li>
            
                <li><a href="../classes/bb.lib.widget.checkbox.html">bb.lib.widget.checkbox</a></li>
            
                <li><a href="../classes/bb.lib.widget.list.html">bb.lib.widget.list</a></li>
            
                <li><a href="../classes/bb.lib.widget.listItem.html">bb.lib.widget.listItem</a></li>
            
                <li><a href="../classes/bb.lib.widget.search.html">bb.lib.widget.search</a></li>
            
                <li><a href="../classes/bb.lib.widget.slider.html">bb.lib.widget.slider</a></li>
            
                <li><a href="../classes/bb.lib.widget.slideswitch.html">bb.lib.widget.slideswitch</a></li>
            
                <li><a href="../classes/bb.lib.widget.toolbar.html">bb.lib.widget.toolbar</a></li>
            
                <li><a href="../classes/boards.content.html">boards.content</a></li>
            
                <li><a href="../classes/boards.lib.html">boards.lib</a></li>
            
                <li><a href="../classes/bundle.doc.html">bundle.doc</a></li>
            
                <li><a href="../classes/bundle.example.lirc.html">bundle.example.lirc</a></li>
            
                <li><a href="../classes/bundle.example.media.html">bundle.example.media</a></li>
            
                <li><a href="../classes/bundle.example.rpi.html">bundle.example.rpi</a></li>
            
                <li><a href="../classes/bundle.examples.lirc.config.html">bundle.examples.lirc.config</a></li>
            
                <li><a href="../classes/bundle.examples.lirc.lirc.html">bundle.examples.lirc.lirc</a></li>
            
                <li><a href="../classes/bundle.examples.media.channels.html">bundle.examples.media.channels</a></li>
            
                <li><a href="../classes/bundle.examples.media.config.html">bundle.examples.media.config</a></li>
            
                <li><a href="../classes/bundle.examples.media.streams.html">bundle.examples.media.streams</a></li>
            
                <li><a href="../classes/bundle.examples.rpi.config.html">bundle.examples.rpi.config</a></li>
            
                <li><a href="../classes/bundle.Gruntfile.html">bundle.Gruntfile</a></li>
            
                <li><a href="../classes/control.content.html">control.content</a></li>
            
                <li><a href="../classes/control.lib.html">control.lib</a></li>
            
                <li><a href="../classes/control.lib.activity.html">control.lib.activity</a></li>
            
                <li><a href="../classes/control.lib.din.html">control.lib.din</a></li>
            
                <li><a href="../classes/control.lib.din.pin.html">control.lib.din.pin</a></li>
            
                <li><a href="../classes/control.lib.distributor.html">control.lib.distributor</a></li>
            
                <li><a href="../classes/control.lib.door.html">control.lib.door</a></li>
            
                <li><a href="../classes/control.lib.door.pin.html">control.lib.door.pin</a></li>
            
                <li><a href="../classes/control.lib.flowMeter.html">control.lib.flowMeter</a></li>
            
                <li><a href="../classes/control.lib.heater.html">control.lib.heater</a></li>
            
                <li><a href="../classes/control.lib.heater.pin.html">control.lib.heater.pin</a></li>
            
                <li><a href="../classes/control.lib.heater.tariff.html">control.lib.heater.tariff</a></li>
            
                <li><a href="../classes/control.lib.light.html">control.lib.light</a></li>
            
                <li><a href="../classes/control.lib.light.pin.html">control.lib.light.pin</a></li>
            
                <li><a href="../classes/control.lib.light.remote.html">control.lib.light.remote</a></li>
            
                <li><a href="../classes/control.lib.light.switch.html">control.lib.light.switch</a></li>
            
                <li><a href="../classes/control.lib.pin.html">control.lib.pin</a></li>
            
                <li><a href="../classes/control.lib.pin.commands.html">control.lib.pin.commands</a></li>
            
                <li><a href="../classes/control.lib.pin.counter.html">control.lib.pin.counter</a></li>
            
                <li><a href="../classes/control.lib.pin.din.html">control.lib.pin.din</a></li>
            
                <li><a href="../classes/control.lib.pin.dout.html">control.lib.pin.dout</a></li>
            
                <li><a href="../classes/control.lib.pin.light.html">control.lib.pin.light</a></li>
            
                <li><a href="../classes/control.lib.pin.list.html">control.lib.pin.list</a></li>
            
                <li><a href="../classes/control.lib.pin.pwm.html">control.lib.pin.pwm</a></li>
            
                <li><a href="../classes/control.lib.pin.switch.html">control.lib.pin.switch</a></li>
            
                <li><a href="../classes/control.lib.remote.html">control.lib.remote</a></li>
            
                <li><a href="../classes/control.lib.room.html">control.lib.room</a></li>
            
                <li><a href="../classes/control.lib.switch.html">control.lib.switch</a></li>
            
                <li><a href="../classes/control.lib.switch.relay.html">control.lib.switch.relay</a></li>
            
                <li><a href="../classes/control.lib.switch.socket.html">control.lib.switch.socket</a></li>
            
                <li><a href="../classes/dvb.content.html">dvb.content</a></li>
            
                <li><a href="../classes/dvb.lib.html">dvb.lib</a></li>
            
                <li><a href="../classes/dvb.lib.channel.html">dvb.lib.channel</a></li>
            
                <li><a href="../classes/fs.content.html">fs.content</a></li>
            
                <li><a href="../classes/fs.lib.html">fs.lib</a></li>
            
                <li><a href="../classes/fs.lib.dir.html">fs.lib.dir</a></li>
            
                <li><a href="../classes/fs.lib.file.html">fs.lib.file</a></li>
            
                <li><a href="../classes/icecast.content.html">icecast.content</a></li>
            
                <li><a href="../classes/icecast.lib.html">icecast.lib</a></li>
            
                <li><a href="../classes/icecast.lib.stream.html">icecast.lib.stream</a></li>
            
                <li><a href="../classes/lirc.content.html">lirc.content</a></li>
            
                <li><a href="../classes/lirc.lib.html">lirc.lib</a></li>
            
                <li><a href="../classes/lirc.lib.lirc.html">lirc.lib.lirc</a></li>
            
                <li><a href="../classes/media.content.html">media.content</a></li>
            
                <li><a href="../classes/media.lib.html">media.lib</a></li>
            
                <li><a href="../classes/media.lib.item.html">media.lib.item</a></li>
            
                <li><a href="../classes/media.lib.player.html">media.lib.player</a></li>
            
                <li><a href="../classes/media.lib.player.commands.html">media.lib.player.commands</a></li>
            
                <li><a href="../classes/media.lib.player.dvb.html">media.lib.player.dvb</a></li>
            
                <li><a href="../classes/media.lib.player.playback.html">media.lib.player.playback</a></li>
            
                <li><a href="../classes/media.lib.player.remote.html">media.lib.player.remote</a></li>
            
                <li><a href="../classes/media.lib.player.volume.html">media.lib.player.volume</a></li>
            
                <li><a href="../classes/media.lib.sources.html">media.lib.sources</a></li>
            
                <li><a href="../classes/media.lib.stream.html">media.lib.stream</a></li>
            
                <li><a href="../classes/ose.content.html">ose.content</a></li>
            
                <li><a href="../classes/ose.core.html">ose.core</a></li>
            
                <li><a href="../classes/ose.lib.browser.html">ose.lib.browser</a></li>
            
                <li><a href="../classes/ose.lib.cli.html">ose.lib.cli</a></li>
            
                <li><a href="../classes/ose.lib.counter.html">ose.lib.counter</a></li>
            
                <li><a href="../classes/ose.lib.entry.html">ose.lib.entry</a></li>
            
                <li><a href="../classes/ose.lib.entry.link.html">ose.lib.entry.link</a></li>
            
                <li><a href="../classes/ose.lib.entry.master.html">ose.lib.entry.master</a></li>
            
                <li><a href="../classes/ose.lib.entry.slave.html">ose.lib.entry.slave</a></li>
            
                <li><a href="../classes/ose.lib.http.html">ose.lib.http</a></li>
            
                <li><a href="../classes/ose.lib.http.content.html">ose.lib.http.content</a></li>
            
                <li><a href="../classes/ose.lib.kind.html">ose.lib.kind</a></li>
            
                <li><a href="../classes/ose.lib.link.html">ose.lib.link</a></li>
            
                <li><a href="../classes/ose.lib.logger.html">ose.lib.logger</a></li>
            
                <li><a href="../classes/ose.lib.node.html">ose.lib.node</a></li>
            
                <li><a href="../classes/ose.lib.peer.here.html">ose.lib.peer.here</a></li>
            
                <li><a href="../classes/ose.lib.peer.list.html">ose.lib.peer.list</a></li>
            
                <li><a href="../classes/ose.lib.peer.remote.html">ose.lib.peer.remote</a></li>
            
                <li><a href="../classes/ose.lib.peer.rx.html">ose.lib.peer.rx</a></li>
            
                <li><a href="../classes/ose.lib.plugins.html">ose.lib.plugins</a></li>
            
                <li><a href="../classes/ose.lib.scope.html">ose.lib.scope</a></li>
            
                <li><a href="../classes/ose.lib.shard.html">ose.lib.shard</a></li>
            
                <li><a href="../classes/ose.lib.shard.master.html">ose.lib.shard.master</a></li>
            
                <li><a href="../classes/ose.lib.shard.slave.html">ose.lib.shard.slave</a></li>
            
                <li><a href="../classes/ose.lib.space.html">ose.lib.space</a></li>
            
                <li><a href="../classes/ose.lib.space.list.html">ose.lib.space.list</a></li>
            
                <li><a href="../classes/ose.lib.ws.html">ose.lib.ws</a></li>
            
                <li><a href="../classes/ose.lib.ws.browser.html">ose.lib.ws.browser</a></li>
            
                <li><a href="../classes/ose.lib.ws.master.html">ose.lib.ws.master</a></li>
            
                <li><a href="../classes/ose.lib.ws.node.html">ose.lib.ws.node</a></li>
            
                <li><a href="../classes/ose.lib.ws.relay.html">ose.lib.ws.relay</a></li>
            
                <li><a href="../classes/ose.lib.ws.slave.html">ose.lib.ws.slave</a></li>
            
                <li><a href="../classes/ose.wrap.class.html">ose.wrap.class</a></li>
            
                <li><a href="../classes/ose.wrap.common.html">ose.wrap.common</a></li>
            
                <li><a href="../classes/ose.wrap.module.html">ose.wrap.module</a></li>
            
                <li><a href="../classes/ose.wrap.package.html">ose.wrap.package</a></li>
            
                <li><a href="../classes/ose.wrap.singleton.html">ose.wrap.singleton</a></li>
            
                <li><a href="../classes/pa.content.html">pa.content</a></li>
            
                <li><a href="../classes/pa.lib.html">pa.lib</a></li>
            
                <li><a href="../classes/pa.lib.dbus.html">pa.lib.dbus</a></li>
            
                <li><a href="../classes/rpi.content.html">rpi.content</a></li>
            
                <li><a href="../classes/rpi.lib.html">rpi.lib</a></li>
            
                <li><a href="../classes/rpi.lib.camera.html">rpi.lib.camera</a></li>
            
                <li><a href="../classes/rpi.lib.rpi.html">rpi.lib.rpi</a></li>
            
                <li><a href="../classes/videolan.content.html">videolan.content</a></li>
            
                <li><a href="../classes/videolan.lib.html">videolan.lib</a></li>
            
                <li><a href="../classes/videolan.lib.dvblast.html">videolan.lib.dvblast</a></li>
            
                <li><a href="../classes/videolan.lib.dvblast.master.html">videolan.lib.dvblast.master</a></li>
            
                <li><a href="../classes/videolan.lib.vlc.html">videolan.lib.vlc</a></li>
            
                <li><a href="../classes/xorg.content.html">xorg.content</a></li>
            
                <li><a href="../classes/xorg.lib.html">xorg.lib</a></li>
            
                <li><a href="../classes/xorg.lib.xorg.html">xorg.lib.xorg</a></li>
            
                <li><a href="../classes/yoctopuce.content.html">yoctopuce.content</a></li>
            
                <li><a href="../classes/yoctopuce.lib.html">yoctopuce.lib</a></li>
            
                <li><a href="../classes/yoctopuce.lib.meteo.html">yoctopuce.lib.meteo</a></li>
            
                <li><a href="../classes/youtube.content.html">youtube.content</a></li>
            
                <li><a href="../classes/youtube.lib.html">youtube.lib</a></li>
            
                <li><a href="../classes/youtube.lib.video.html">youtube.lib.video</a></li>
            
        </ul>
    </div>
</div>


      </div>

      <div id="main" class="yui3-u">
        <div class="content"><h4>../bb/lib/pagelet/list.js</h4>

<pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

var Ose = require(&#x27;ose&#x27;);
var M = Ose.class(module, &#x27;./index&#x27;);

/** Docs {{{1
 * @submodule bb.pagelet
 */

/**
 * @caption List of entries pagelet
 *
 * @readme
 * Pagelet for displaying lists of entries
 *
 * @class bb.lib.pagelet.list
 * @type class
 * @extends bb.lib.pagelet
 */

// Public {{{1
exports.layout = &#x27;list&#x27;;

exports.loadData = function(cb) {  // {{{2
  var that = this;

  if (cb) {
    this.doAfterDisplay = cb;
  }

  if (this.stateObj.showAdd === false) {
    this.showAdd = false;
  }

  if (this.stateObj.shard) {
    Ose.spaces.findShard(this.stateObj, onShard);
  } else {
    this.scope = Ose.scope(this.stateObj.scope);

    if (this.stateObj.space) {
      Ose.spaces.get(this.stateObj.space, onSpace);
    } else {
      setup();
    }
  }

  function onShard(err, shard) {  // {{{3
    if (err) {
      M.log.error(err);

      that.afterDisplay();
    } else {
      that.shard = shard;
      that.scope = shard.scope;

      setup();
    }
  };

  function onSpace(err, space) {  // {{{3
    if (err) {
      M.log.error(err);

      that.afterDisplay();
    } else {
      that.space = space;

      setup();
    }
  };

  function setup() {  // {{{3
    that.kind = that.scope.kinds[that.stateObj.kind];
    if (that.kind) {
      var layout = that.kind.getLayout(&#x27;list&#x27;, that.stateObj.layout);
      if (layout) {
        for (var key in layout) {
          that[key] = layout[key];
        }
      }
    }

    that.$()
      .attr(&#x27;data-type&#x27;, &#x27;list&#x27;)
      .empty()
      .append($(&#x27;&lt;ul&gt;&#x27;))
    ;

    that.printHeader();

    if (that.displayLayout) {
      that.displayLayout();
    }

    that.update(that.stateObj, true);
  };

  // }}}3
};

exports.verifyStateObj = function(data) {  // {{{2
  if (data.pagelet !== &#x27;list&#x27;) return false;

  if (data.layout &amp;&amp; (this.stateObj.layout !== data.layout)) return false;

  if (data.space) {
    if (! this.space) return false;
    if (this.space.name !== data.space) return false;
  }

  if (data.shard) {
    if (! (this.shard &amp;&amp; this.shard.isIdentified(data))) return false;
  }

  if (data.scope &amp;&amp; ! (this.scope &amp;&amp; this.scope.name === data.scope)) return false;

  if (data.kind &amp;&amp; ! (this.kind &amp;&amp; this.kind.name === data.kind)) return false;

  return true;
};

exports.update = function(stateObj, force, keep) {  // {{{2
/**
  * Call to update list
  *
  * @param stateObj {Object} New state object
  * @param force {Boolean} If true, perform update even though stateObj is unchanged.
  * @param keep {Boolean} Keep non-persistent list items.
  *
  * @method update
  */

  if (
    ! force &amp;&amp;
    Ose._.isEqual(stateObj.filter, this.stateObj.filter) &amp;&amp;
    Ose._.isEqual(stateObj.sortby, this.stateObj.sortby)
  ) {
    return;
  }

  if (stateObj.filter) {
    this.stateObj.filter = stateObj.filter;
  }

  if (stateObj.sortby) {
    this.stateObj.sortby = stateObj.sortby;
  }

  var params = {
    filter: this.stateObj.filter,
    sortby: this.stateObj.sortby || &#x27;relevance&#x27;,
    startstateObj: this.stateObj.startstateObj,
    endstateObj: this.stateObj.endstateObj,
    loadMore: stateObj.loadMore
  };

//  console.log(&#x27;UPDATE&#x27;, stateObj);

  if (! keep) {
    this.$(&#x27; &gt; ul&#x27;).children(&#x27;:not(&quot;.persistent&quot;)&#x27;).remove();
  }

  if (this.shard) {
    this.shard.getView(
      params,
      onData.bind(this)
    );
  } else if (this.space) {
    M.log.missing();
  } else {
    this.scope.getView(
      this.kind &amp;&amp; this.kind.name,
      params,
      onData.bind(this)
    );
  }

  if (! force) {
    Ose.ui.updateHistory();
  }

  return;
};

exports.printListEntry = function(entry) {  // {{{2
/**
  * Prints entry list item
  *
  * @param entry {Object} Entry instance to be printed
  *
  * @method printListEntry
  */

  if (! this.kind) {
    var unit = entry.kind.getLayout(&#x27;list&#x27;, this.stateObj.layout);
    if (unit &amp;&amp; unit.printListEntry) {
      unit.printListEntry.call(this, entry);
      return;
    }
  }

  var pagelet = this.newPagelet({
    pagelet: &#x27;listItem&#x27;,
  });

  pagelet.html()
    .on(&#x27;click&#x27;, onTap.bind(this))
    .appendTo(this.$(&#x27; &gt; ul&#x27;))
  ;

  pagelet.loadData(null, entry);

  return;
};

exports.printHeader = function() {  // {{{2
/**
  * Prints list header
  *
  * @method printHeader
  */

  var that = this;
  var header = this.$(&#x27;header&#x27;);

  $(&#x27;&lt;span&gt;&#x27;).appendTo(header);

/*
  if (this.showAdd) {
    $(&#x27;&lt;a&gt;&#x27;, {
      href: &#x27;#&#x27;,
      &#x27;data-role&#x27;: &#x27;button&#x27;,
      &#x27;data-icon&#x27;: &#x27;add&#x27;,
      &#x27;data-iconpos&#x27;: &#x27;left&#x27;,
      &#x27;data-mini&#x27;: true,
      &#x27;data-inline&#x27;: true
    })
    .append(&#x27;Add &#x27; + this.kind.name)
    .appendTo(header.children(&#x27;span:first&#x27;))
    .on(&#x27;click&#x27;, (this.onTapAdd ? this.onTapAdd.bind(this) : onTapAdd))
    ;
  } else {
    header.children(&#x27;span:first&#x27;).append(this.kind.name);
  }
*/

  if (this.kind) {
    header.children(&#x27;span:first&#x27;).append(&#x27;&quot;&#x27; + this.kind.name + &#x27;&quot; list&#x27;);
  }

  if (this.showLabels) {
    $(&#x27;&lt;a&gt;&#x27;, {
      href: &#x27;#&#x27;,
      &#x27;data-role&#x27;: &#x27;button&#x27;,
      &#x27;data-inline&#x27;: true,
      &#x27;data-mini&#x27;: true,
    })
    .append(&#x27;Labels&#x27;)
    .appendTo(header.children(&#x27;span&#x27;))
    .on(&#x27;click&#x27;, onTapLabels)
    ;
  }

  function onTapAdd() {  // {{{3
    Ose.ui.newPage({
      pagelet: &#x27;add&#x27;,
      space: that.stateObj.space,
      scope: that.stateObj.scope,
      kind: that.stateObj.kind,
      data: that.generateAddData(),
      dialog: true
    });
  }

  function onTapLabels(ev) {  // {{{3
    M.log.missing();
    /*
    var popup = Ose.classes.object(&#x27;ose-bb/lib/pagelet/popup&#x27;, ev.currentTarget);

    var listBit = popup.displayBit({
      bit: &#x27;list&#x27;,
      space: that.stateObj.space,
      scope: that.stateObj.scope,  // TODO generalize
      kind: &#x27;label&#x27;
    });

    listBit.tapItem = select;

    return false;

    function select(id) {
      switch (id) {
        case &#x27;all&#x27;:
          that.update({});
          break;

        case &#x27;unsolved&#x27;:
          that.update({unsolved: true});
          break;

        default:
          that.update({label: id});
      }

      popup.close();
    }
    */
  }

  // }}}3
};

exports.onSearch = function(value) {  // {{{2
  var filter = JSON.parse(JSON.stringify(this.stateObj.filter || {}));

  filter.search = value;

  this.update({filter: filter});
};

// }}}1
// Event Handlers {{{1
function onData(err, data) {  // {{{2
//  console.log(&#x27;LIST ON DATA&#x27;, err, data);

  if (err) {
    M.log.error(err);

    this.afterDisplay();

    return;
  }

  var that = this;

  if (this.displayData) this.displayData(data);

  if (this.shard) {
    onShard(this.shard, data);
  } else if (this.space) {
    onSpace(data, null, this.space);
  } else {
    for (var key in data.view) {
      Ose.spaces.get(key, onSpace.bind(null, data.view[key]));
//      onShard(Ose.shards[key], data.view[key]);
    }
  }

  this.afterDisplay();

  return;

  function onSpace(view, n, space) {
    for (var key in view) {
      onShard(space.shards[key], view[key]);
    }
  };

  function onShard(shard, view) {
    for (var i = 0; i &lt; view.length; i++) {
      shard.get(view[i], onEntry);
    }
  };

  function onEntry(err, entry) {
//    console.log(&#x27;PAGELET LIST ON ENTRY&#x27;, arguments);

    if (err) {
      M.log.error(err);
    } else {
      that.printListEntry(entry);
    }
  }
};

function onTap(ev) {  // {{{2
//  console.log(&#x27;LIST PAGELET ON TAP&#x27;, ev, this.stateObj);

  var li = $(ev.currentTarget);
  var pagelet = li.prop(&#x27;ose&#x27;);

  if (this.tapItem) {
    this.tapItem(ev, pagelet);
  } else {
    pagelet &amp;&amp; pagelet.tapItem &amp;&amp; pagelet.tapItem(ev);
  }

  return false;
};

// }}}1

</pre>

</div>
      </div>

    </div>
  </div>
  <script src="../assets/vendor/prettify/prettify-min.js"></script>
  <script>prettyPrint();</script>
  <script src="../assets/js/yui-prettify.js"></script>
  <script src="../assets/js/ose.js"></script>
</body>
</html>
