<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>../ose/lib/entry/index.js - ose-bundle</title>
  <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
  <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
  <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
  <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/zepto/1.1.4/zepto.min.js"></script>
</head>
<body class="yui3-skin-sam">

  <div id="doc">
    <div class="yui3-g">

      <div id="sidebar" class="yui3-u">
        <a href="../index.html"><h2>OSE documentation</h2></a>

        <div class="sidebox">
          <div class="hd">
            <h2 class="no-toc">Type to filter sidebar:</h2>
          </div>
          <div class="bd">
            <input id="filter-input" />
          </div>
        </div>

        







<div id="modules" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">All packages and components</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../modules/bb.html">bb</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/bb.html#bb.box">bb.box</a></li> -->
                            <li><a href="../modules/bb.box.html">bb.box</a></li>
                        
                            <!-- <li><a href="../modules/bb.html#bb.dialog">bb.dialog</a></li> -->
                            <li><a href="../modules/bb.dialog.html">bb.dialog</a></li>
                        
                            <!-- <li><a href="../modules/bb.html#bb.pagelet">bb.pagelet</a></li> -->
                            <li><a href="../modules/bb.pagelet.html">bb.pagelet</a></li>
                        
                            <!-- <li><a href="../modules/bb.html#bb.widget">bb.widget</a></li> -->
                            <li><a href="../modules/bb.widget.html">bb.widget</a></li>
                        
                            <!-- <li><a href="../modules/bb.html#bb.stateObj">bb.stateObj</a></li> -->
                            <li><a href="../modules/bb.stateObj.html">bb.stateObj</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/boards.html">boards</a>
                
                </li>
            
                <li><a href="../modules/bundle.html">bundle</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/bundle.html#bundle.media">bundle.media</a></li> -->
                            <li><a href="../modules/bundle.media.html">bundle.media</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/control.html">control</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/control.html#control.distributor">control.distributor</a></li> -->
                            <li><a href="../modules/control.distributor.html">control.distributor</a></li>
                        
                            <!-- <li><a href="../modules/control.html#control.pin">control.pin</a></li> -->
                            <li><a href="../modules/control.pin.html">control.pin</a></li>
                        
                            <!-- <li><a href="../modules/control.html#control.room">control.room</a></li> -->
                            <li><a href="../modules/control.room.html">control.room</a></li>
                        
                            <!-- <li><a href="../modules/control.html#control.remote">control.remote</a></li> -->
                            <li><a href="../modules/control.remote.html">control.remote</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/dvb.html">dvb</a>
                
                </li>
            
                <li><a href="../modules/fs.html">fs</a>
                
                </li>
            
                <li><a href="../modules/icecast.html">icecast</a>
                
                </li>
            
                <li><a href="../modules/lirc.html">lirc</a>
                
                </li>
            
                <li><a href="../modules/media.html">media</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/media.html#media.history">media.history</a></li> -->
                            <li><a href="../modules/media.history.html">media.history</a></li>
                        
                            <!-- <li><a href="../modules/media.html#media.player">media.player</a></li> -->
                            <li><a href="../modules/media.player.html">media.player</a></li>
                        
                            <!-- <li><a href="../modules/media.html#media.stream">media.stream</a></li> -->
                            <li><a href="../modules/media.stream.html">media.stream</a></li>
                        
                            <!-- <li><a href="../modules/media.html#media.source">media.source</a></li> -->
                            <li><a href="../modules/media.source.html">media.source</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/ose.html">ose</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/ose.html#ose.data">ose.data</a></li> -->
                            <li><a href="../modules/ose.data.html">ose.data</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.http">ose.http</a></li> -->
                            <li><a href="../modules/ose.http.html">ose.http</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.peer">ose.peer</a></li> -->
                            <li><a href="../modules/ose.peer.html">ose.peer</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.link">ose.link</a></li> -->
                            <li><a href="../modules/ose.link.html">ose.link</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.logger">ose.logger</a></li> -->
                            <li><a href="../modules/ose.logger.html">ose.logger</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.plugin">ose.plugin</a></li> -->
                            <li><a href="../modules/ose.plugin.html">ose.plugin</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.wrap">ose.wrap</a></li> -->
                            <li><a href="../modules/ose.wrap.html">ose.wrap</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/pa.html">pa</a>
                
                </li>
            
                <li><a href="../modules/rpi.html">rpi</a>
                
                </li>
            
                <li><a href="../modules/videolan.html">videolan</a>
                
                </li>
            
                <li><a href="../modules/xorg.html">xorg</a>
                
                </li>
            
                <li><a href="../modules/yoctopuce.html">yoctopuce</a>
                
                </li>
            
                <li><a href="../modules/youtube.html">youtube</a>
                
                </li>
            
        </ul>
    </div>
</div>

<div id="classes" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">All modules</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../classes/bb.content.html">bb.content</a></li>
            
                <li><a href="../classes/bb.lib.html">bb.lib</a></li>
            
                <li><a href="../classes/bb.lib.box.content.html">bb.lib.box.content</a></li>
            
                <li><a href="../classes/bb.lib.box.left.html">bb.lib.box.left</a></li>
            
                <li><a href="../classes/bb.lib.dialog.html">bb.lib.dialog</a></li>
            
                <li><a href="../classes/bb.lib.dialog.action.html">bb.lib.dialog.action</a></li>
            
                <li><a href="../classes/bb.lib.dialog.confirm.html">bb.lib.dialog.confirm</a></li>
            
                <li><a href="../classes/bb.lib.dialog.info.html">bb.lib.dialog.info</a></li>
            
                <li><a href="../classes/bb.lib.dialog.valueSelector.html">bb.lib.dialog.valueSelector</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.html">bb.lib.pagelet</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.dashboard.html">bb.lib.pagelet.dashboard</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.detail.html">bb.lib.pagelet.detail</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.entry.html">bb.lib.pagelet.entry</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.gesture.html">bb.lib.pagelet.gesture</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.list.html">bb.lib.pagelet.list</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.listItem.html">bb.lib.pagelet.listItem</a></li>
            
                <li><a href="../classes/bb.lib.widget.html">bb.lib.widget</a></li>
            
                <li><a href="../classes/bb.lib.widget.button.html">bb.lib.widget.button</a></li>
            
                <li><a href="../classes/bb.lib.widget.checkbox.html">bb.lib.widget.checkbox</a></li>
            
                <li><a href="../classes/bb.lib.widget.list.html">bb.lib.widget.list</a></li>
            
                <li><a href="../classes/bb.lib.widget.listItem.html">bb.lib.widget.listItem</a></li>
            
                <li><a href="../classes/bb.lib.widget.search.html">bb.lib.widget.search</a></li>
            
                <li><a href="../classes/bb.lib.widget.slider.html">bb.lib.widget.slider</a></li>
            
                <li><a href="../classes/bb.lib.widget.slideswitch.html">bb.lib.widget.slideswitch</a></li>
            
                <li><a href="../classes/bb.lib.widget.toolbar.html">bb.lib.widget.toolbar</a></li>
            
                <li><a href="../classes/boards.content.html">boards.content</a></li>
            
                <li><a href="../classes/boards.lib.html">boards.lib</a></li>
            
                <li><a href="../classes/bundle.doc.html">bundle.doc</a></li>
            
                <li><a href="../classes/bundle.example.media.html">bundle.example.media</a></li>
            
                <li><a href="../classes/bundle.examples.media.config.html">bundle.examples.media.config</a></li>
            
                <li><a href="../classes/bundle.Gruntfile.html">bundle.Gruntfile</a></li>
            
                <li><a href="../classes/control.content.html">control.content</a></li>
            
                <li><a href="../classes/control.lib.html">control.lib</a></li>
            
                <li><a href="../classes/control.lib.activity.html">control.lib.activity</a></li>
            
                <li><a href="../classes/control.lib.din.html">control.lib.din</a></li>
            
                <li><a href="../classes/control.lib.din.pin.html">control.lib.din.pin</a></li>
            
                <li><a href="../classes/control.lib.distributor.html">control.lib.distributor</a></li>
            
                <li><a href="../classes/control.lib.door.html">control.lib.door</a></li>
            
                <li><a href="../classes/control.lib.door.pin.html">control.lib.door.pin</a></li>
            
                <li><a href="../classes/control.lib.flowMeter.html">control.lib.flowMeter</a></li>
            
                <li><a href="../classes/control.lib.heater.html">control.lib.heater</a></li>
            
                <li><a href="../classes/control.lib.heater.pin.html">control.lib.heater.pin</a></li>
            
                <li><a href="../classes/control.lib.heater.tariff.html">control.lib.heater.tariff</a></li>
            
                <li><a href="../classes/control.lib.light.html">control.lib.light</a></li>
            
                <li><a href="../classes/control.lib.light.pin.html">control.lib.light.pin</a></li>
            
                <li><a href="../classes/control.lib.light.remote.html">control.lib.light.remote</a></li>
            
                <li><a href="../classes/control.lib.light.switch.html">control.lib.light.switch</a></li>
            
                <li><a href="../classes/control.lib.pin.html">control.lib.pin</a></li>
            
                <li><a href="../classes/control.lib.pin.commands.html">control.lib.pin.commands</a></li>
            
                <li><a href="../classes/control.lib.pin.counter.html">control.lib.pin.counter</a></li>
            
                <li><a href="../classes/control.lib.pin.din.html">control.lib.pin.din</a></li>
            
                <li><a href="../classes/control.lib.pin.dout.html">control.lib.pin.dout</a></li>
            
                <li><a href="../classes/control.lib.pin.light.html">control.lib.pin.light</a></li>
            
                <li><a href="../classes/control.lib.pin.list.html">control.lib.pin.list</a></li>
            
                <li><a href="../classes/control.lib.pin.pwm.html">control.lib.pin.pwm</a></li>
            
                <li><a href="../classes/control.lib.pin.switch.html">control.lib.pin.switch</a></li>
            
                <li><a href="../classes/control.lib.remote.html">control.lib.remote</a></li>
            
                <li><a href="../classes/control.lib.room.html">control.lib.room</a></li>
            
                <li><a href="../classes/control.lib.switch.html">control.lib.switch</a></li>
            
                <li><a href="../classes/control.lib.switch.relay.html">control.lib.switch.relay</a></li>
            
                <li><a href="../classes/control.lib.switch.socket.html">control.lib.switch.socket</a></li>
            
                <li><a href="../classes/dvb.content.html">dvb.content</a></li>
            
                <li><a href="../classes/dvb.lib.html">dvb.lib</a></li>
            
                <li><a href="../classes/dvb.lib.channel.html">dvb.lib.channel</a></li>
            
                <li><a href="../classes/fs.content.html">fs.content</a></li>
            
                <li><a href="../classes/fs.lib.html">fs.lib</a></li>
            
                <li><a href="../classes/fs.lib.dir.html">fs.lib.dir</a></li>
            
                <li><a href="../classes/fs.lib.file.html">fs.lib.file</a></li>
            
                <li><a href="../classes/icecast.content.html">icecast.content</a></li>
            
                <li><a href="../classes/icecast.lib.html">icecast.lib</a></li>
            
                <li><a href="../classes/icecast.lib.stream.html">icecast.lib.stream</a></li>
            
                <li><a href="../classes/lirc.content.html">lirc.content</a></li>
            
                <li><a href="../classes/lirc.lib.html">lirc.lib</a></li>
            
                <li><a href="../classes/lirc.lib.lirc.html">lirc.lib.lirc</a></li>
            
                <li><a href="../classes/media.content.html">media.content</a></li>
            
                <li><a href="../classes/media.lib.html">media.lib</a></li>
            
                <li><a href="../classes/media.lib.item.html">media.lib.item</a></li>
            
                <li><a href="../classes/media.lib.player.html">media.lib.player</a></li>
            
                <li><a href="../classes/media.lib.player.commands.html">media.lib.player.commands</a></li>
            
                <li><a href="../classes/media.lib.player.dvb.html">media.lib.player.dvb</a></li>
            
                <li><a href="../classes/media.lib.player.playback.html">media.lib.player.playback</a></li>
            
                <li><a href="../classes/media.lib.player.volume.html">media.lib.player.volume</a></li>
            
                <li><a href="../classes/media.lib.sources.html">media.lib.sources</a></li>
            
                <li><a href="../classes/media.lib.stream.html">media.lib.stream</a></li>
            
                <li><a href="../classes/ose.content.html">ose.content</a></li>
            
                <li><a href="../classes/ose.core.html">ose.core</a></li>
            
                <li><a href="../classes/ose.lib.browser.html">ose.lib.browser</a></li>
            
                <li><a href="../classes/ose.lib.cli.html">ose.lib.cli</a></li>
            
                <li><a href="../classes/ose.lib.counter.html">ose.lib.counter</a></li>
            
                <li><a href="../classes/ose.lib.entry.html">ose.lib.entry</a></li>
            
                <li><a href="../classes/ose.lib.entry.link.html">ose.lib.entry.link</a></li>
            
                <li><a href="../classes/ose.lib.entry.master.html">ose.lib.entry.master</a></li>
            
                <li><a href="../classes/ose.lib.entry.slave.html">ose.lib.entry.slave</a></li>
            
                <li><a href="../classes/ose.lib.http.html">ose.lib.http</a></li>
            
                <li><a href="../classes/ose.lib.http.content.html">ose.lib.http.content</a></li>
            
                <li><a href="../classes/ose.lib.kind.html">ose.lib.kind</a></li>
            
                <li><a href="../classes/ose.lib.link.html">ose.lib.link</a></li>
            
                <li><a href="../classes/ose.lib.logger.html">ose.lib.logger</a></li>
            
                <li><a href="../classes/ose.lib.node.html">ose.lib.node</a></li>
            
                <li><a href="../classes/ose.lib.peer.here.html">ose.lib.peer.here</a></li>
            
                <li><a href="../classes/ose.lib.peer.list.html">ose.lib.peer.list</a></li>
            
                <li><a href="../classes/ose.lib.peer.remote.html">ose.lib.peer.remote</a></li>
            
                <li><a href="../classes/ose.lib.peer.rx.html">ose.lib.peer.rx</a></li>
            
                <li><a href="../classes/ose.lib.plugins.html">ose.lib.plugins</a></li>
            
                <li><a href="../classes/ose.lib.scope.html">ose.lib.scope</a></li>
            
                <li><a href="../classes/ose.lib.shard.html">ose.lib.shard</a></li>
            
                <li><a href="../classes/ose.lib.shard.master.html">ose.lib.shard.master</a></li>
            
                <li><a href="../classes/ose.lib.shard.slave.html">ose.lib.shard.slave</a></li>
            
                <li><a href="../classes/ose.lib.space.html">ose.lib.space</a></li>
            
                <li><a href="../classes/ose.lib.space.list.html">ose.lib.space.list</a></li>
            
                <li><a href="../classes/ose.lib.ws.html">ose.lib.ws</a></li>
            
                <li><a href="../classes/ose.lib.ws.browser.html">ose.lib.ws.browser</a></li>
            
                <li><a href="../classes/ose.lib.ws.master.html">ose.lib.ws.master</a></li>
            
                <li><a href="../classes/ose.lib.ws.node.html">ose.lib.ws.node</a></li>
            
                <li><a href="../classes/ose.lib.ws.relay.html">ose.lib.ws.relay</a></li>
            
                <li><a href="../classes/ose.lib.ws.slave.html">ose.lib.ws.slave</a></li>
            
                <li><a href="../classes/ose.wrap.class.html">ose.wrap.class</a></li>
            
                <li><a href="../classes/ose.wrap.common.html">ose.wrap.common</a></li>
            
                <li><a href="../classes/ose.wrap.module.html">ose.wrap.module</a></li>
            
                <li><a href="../classes/ose.wrap.package.html">ose.wrap.package</a></li>
            
                <li><a href="../classes/ose.wrap.singleton.html">ose.wrap.singleton</a></li>
            
                <li><a href="../classes/pa.content.html">pa.content</a></li>
            
                <li><a href="../classes/pa.lib.html">pa.lib</a></li>
            
                <li><a href="../classes/pa.lib.dbus.html">pa.lib.dbus</a></li>
            
                <li><a href="../classes/rpi.content.html">rpi.content</a></li>
            
                <li><a href="../classes/rpi.lib.html">rpi.lib</a></li>
            
                <li><a href="../classes/rpi.lib.camera.html">rpi.lib.camera</a></li>
            
                <li><a href="../classes/rpi.lib.rpi.html">rpi.lib.rpi</a></li>
            
                <li><a href="../classes/videolan.content.html">videolan.content</a></li>
            
                <li><a href="../classes/videolan.lib.html">videolan.lib</a></li>
            
                <li><a href="../classes/videolan.lib.dvblast.html">videolan.lib.dvblast</a></li>
            
                <li><a href="../classes/videolan.lib.dvblast.master.html">videolan.lib.dvblast.master</a></li>
            
                <li><a href="../classes/videolan.lib.vlc.html">videolan.lib.vlc</a></li>
            
                <li><a href="../classes/xorg.content.html">xorg.content</a></li>
            
                <li><a href="../classes/xorg.lib.html">xorg.lib</a></li>
            
                <li><a href="../classes/xorg.lib.xorg.html">xorg.lib.xorg</a></li>
            
                <li><a href="../classes/yoctopuce.content.html">yoctopuce.content</a></li>
            
                <li><a href="../classes/yoctopuce.lib.html">yoctopuce.lib</a></li>
            
                <li><a href="../classes/yoctopuce.lib.meteo.html">yoctopuce.lib.meteo</a></li>
            
                <li><a href="../classes/youtube.content.html">youtube.content</a></li>
            
                <li><a href="../classes/youtube.lib.html">youtube.lib</a></li>
            
                <li><a href="../classes/youtube.lib.video.html">youtube.lib.video</a></li>
            
        </ul>
    </div>
</div>


      </div>

      <div id="main" class="yui3-u">
        <div class="content"><h4>../ose/lib/entry/index.js</h4>

<pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

var Ose = require(&#x27;ose&#x27;);
var M = Ose.class(module, C, &#x27;EventEmitter&#x27;);

var Kind = M.class(&#x27;../kind&#x27;);
var Master = M.class(&#x27;./master&#x27;);
var Slave = M.class(&#x27;./slave&#x27;);

/** Doc {{{1
 * @submodule ose.data
 */

/**
 * @caption Entry class
 *
 * @readme

 * An [Entry] instance is a data structure representing a physical
 * object or logical concept. Each [entry] belongs to a certain
 * [shard]. Within the [shard], it has a unique &#x60;id&#x60;. Each [entry] is
 * of a certain [kind] that defines its behaviour. An [entry] can
 * contain a &#x60;data&#x60; object in JSON format (analogous to a database
 * table row). At the moment, &#x60;data&#x60; are defined at the start-up of an
 * [OSE instance] and are immutable. Data management and persistence
 * are planned features. The &#x60;state&#x60; JSON object, unlike &#x60;data&#x60;, can
 * often change and is non-persistent by design because it reflects
 * changing objective reality. Changes of &#x60;state&#x60; objects are
 * propagated to [peers] tracking changes of certain [entries].
 *
 * @todo
 * [Entries] can receive &#x60;action&#x60; objects in JSON format.
 *
 * @aliases entry entries data state statesOfEntries
 *
 * @class ose.lib.entry
 * @extends eventEmitter
 * @type class
 */

/** id {{{2
 * ID of entry within shard
 *
 * @property id
 * @type String
 */

/** shard {{{2
 * Reference to containing [shard]
 *
 * @property shard
 * @type Object
 */

/** kind {{{2
 * Reference to [entry kind]
 *
 * @property kind
 * @type Object
 */

/** drev {{{2
 * Timestamp in microseconds of last data update
 *
 * @property drev
 * @type Number
 */

/** data {{{2
 * Persistent data
 *
 * @property data
 * @type Object
 */

/** master {{{2
 * Reference to [slave entry client socket]
 *
 * @property master
 * @type Objectp
 */

/** srev {{{2
 * Timestamp in microseconds of last state update
 *
 * @property srev
 * @type Number
 */

/** state {{{2
 * Non-persistent data
 *
 * @property state
 * @type Object
 */

/** synced {{{2
 * Indicates whether entry is sync with its home
 *
 * @property synced
 * @type Boolean
 */

/** queuedState {{{2
 * Queued state
 *
 * @property queuedState
 * @type Object
 * @private
 */

/** queueStateHandle {{{2
 * Timeout handle
 *
 * @property queueStateHandle
 * @type Number
 * @private
 */

/** queueStateTimeout {{{2
 * Setup this property to enable set state queue
 *
 * @property queueStateTimeout
 * @type Number integer milliseconds
 */

/** removed {{2
 * Set to TRUE when the entry is removed
 *
 * @type Boolean
 */

/** slaveId {{{2
 * Last slave id
 *
 * @property slaveId
 * @type Number
 * @private
 */

/** slaves {{{2
 * Contains all response sockets of slave entries
 *
 * @property slaves
 * @type Object
 * @private
 */

/** dtc {{{2
 * Count of data trackers
 *
 * @property dtc
 * @type Number
 * @private
 */

/** stc {{{2
 * Count of clients state trackers
 *
 * @property stc
 * @type Number
 * @private
 */

// }}}1
// Public {{{1
function C(shard, id) {  // {{{2
/**
 * Entry constructor
 *
 * @param shard {Object} Entry owner shard instance
 * @param id {String|Number} Entry id
 *
 * @method constructor
 */

  if (id in shard.cache) {
    throw Ose.error(shard, &#x27;duplicitEntry&#x27;, arguments);
  }

  M.super.call(this);

  this.setMaxListeners &amp;&amp; this.setMaxListeners(1000);

  this.shard = shard;  // Containing shard.
  this.id = id;

  this.drev = 0;
  this.srev = 0;

  shard.cache[id] = this;
};

exports.setup = function(kind) {  // {{{2
/**
 * Sets entry properties
 *
 * @param kind {String|Object} Kind of entry
 *
 * @method setup
 */

  switch (typeof kind) {
  case &#x27;string&#x27;:
    this.kind = this.shard.scope.kinds[kind];

    if (! this.kind) {
      throw Ose.error(this, &#x27;invalidKind&#x27;, {kind: kind});
    }
    break;
  case &#x27;object&#x27;:
    if (! M.isSuper(Kind, kind)) {
      throw Ose.error(this, &#x27;invalidKind&#x27;, {kind: kind});
    }

    this.kind = kind;
    break;
  default:
    throw Ose.error(this, &#x27;invalidKind&#x27;, {kind: kind});
  }

  if (! this.drev) {
    this.drev = 0;
  }
  if (! (&#x27;data&#x27; in this)) {
    this.data = {};
  }

  if (! this.srev) {
    this.srev = 0;
  }
  if (! (&#x27;state&#x27; in this)) {
    this.state = {};
  }

  this.initEntry &amp;&amp; this.initEntry();  // TODO: Check &#x60;initEntry&#x60; usage.
  this.kind.initEntry &amp;&amp; this.kind.initEntry(this);

  if (this.shard.atHome()) {
    setupHome(this);
  }

  this.emit(&#x27;setup&#x27;);
};

exports.remove = function() {  // {{{2
/**
 * Removes entry from shard
 *
 * @method remove
 */

//  console.log(&#x27;ENTRY REMOVE&#x27;, this.id);

  this.removed = true;

  delete this.shard.cache[this.id];

  if (this.slaves) {
    for (var key in this.slaves) {
      Ose.link.close(this.slaves[key]);
    }
    delete this.slaves;
    delete this.dtc;
    delete this.stc;
  }

  if (this.master) {
    Ose.link.close(this.master);
    delete this.master;
  }

  if (this.queueStateHandle) {
    clearTimeout(this.queueStateHandle);
    delete this.queueStateHandle;
    delete this.queuedState;
  }

  this.emit(&#x27;remove&#x27;);
};

exports.getCaption = function() {  // {{{2
/**
 * Returns entry caption
 *
 * @return {String} Entry caption
 *
 * @method getCaption
 */

  return this.kind &amp;&amp; this.kind.getCaption(this) || this.id;
};

exports.command = function(name, data, socket) {  // {{{2
/**
 * Executes a command on the current entry
 *
 * @param name {String} Command name
 * @param data {*} Data to be sent
 * @param socket {Object} Client socket
 *
 * @method command
 */

//  console.log(&#x27;ENTRY COMMAND&#x27;, this.id, name, data);

  if (this.commands &amp;&amp; (name in this.commands)) {
    this.commands[name].call({entry: this}, data, socket);
    return;
  }

  if (this.kind.commands &amp;&amp; (name in this.kind.commands)) {
    this.kind.commands[name].call({entry: this}, data, socket);
    return;
  }

  Ose.link.error(socket, Ose.error(this, &#x27;UNKNOWN_COMMAND&#x27;, {name: name, data: data}));
  return;
};

exports.post = function(name, data, socket) {  // {{{2
/**
 * Executes a command on the entry at home.
 *
 * @param name {String} Command name
 * @param [data] {*} Data to be sent
 * @param [socket] {Object} Client socket
 *
 * @method post
 */

//  console.log(&#x27;ENTRY POST&#x27;, this.id, name, data);

  if (this.shard.atHome()) {
    var that = this;

    setTimeout(function() {
      that.command(name, data, socket);
    }, 0);
    return;
  }

  this.shard.send(this.id, name, data, socket);
  return;
}

exports.postTo = function(target, name, data, socket) {  // {{{2
/**
 * Send command to target&#x27;s home
 *
 * @param target {String|Object} Target id or target identification object
 * @param name {String} Command name
 * @param [data] {*} Data to be sent
 * @param [socket] {Object|Function}
 *
 * @method postTo
 */

//  console.log(&#x27;ENTRY POST TO&#x27;, Ose.identify(target), name, data);

  switch (typeof target) {
  case &#x27;number&#x27;:  // &#x60;target&#x60; is at same &#x60;shard&#x60; and is identified by &#x60;id&#x60;
  case &#x27;string&#x27;:
    if (target === this.id) {  // &#x60;target&#x60; === &#x60;this&#x60;
      this.post(name, data, socket);
      return;
    }

    doIt(this.shard, target);
    return;
  case &#x27;object&#x27;:  // &#x60;target&#x60; is some object
    if (typeof target.identify === &#x27;function&#x27;) {  // &#x60;target&#x60; is entry instance
      if (target === this) {  // &#x60;target&#x60; === &#x60;this&#x60;
        this.post(name, data, socket);
        return;
      }

      target.post(name, data, socket);
      return;
    }

    this.findShard(target, function(err, shard) {
      if (err) {
        Ose.link.error(socket, err);
      } else {
        doIt(shard, target.entry);
      }
    });
    return;
  }

  throw Ose.error(this, &#x27;invalidArgs&#x27;, arguments);

  function doIt(shard, target) {
    if (! shard.atHome()) {
      shard.send(target, name, data, socket);
      return;
    }

    shard.get(target, function(err, entry) {
      if (err) {
        Ose.link.error(socket, err);
      } else {
        entry.command(name, data, socket);
      }
    });
    return;
  };
};

exports.onStates = function(handlers) {  // {{{2
/**
 * Register state handlers
 *
 * @param handlers {Object} Handlers object
 *
 * @method onStates
 */

  var that = this;

  this.on(&#x27;state&#x27;, function(data) {
    for (var key in data) {
      if (key in handlers) {
        handlers[key](that, data[key], data);
      }
    }
  });
};

exports.setState = function(data, src) {  // {{{2
/**
 * Change entry &quot;state&quot;. Can be called only in the home. Data are
 * altered (unchanged keys are removed).
 *
 * @param data {Object} Data object
 * @param [src] {Object} Source of a change
 *
 * @method setState
 */

//  console.log(&#x27;SET STATE&#x27;, this.identify(), data);

  if (typeof data !== &#x27;object&#x27;) {
    M.log.error(Ose.error(this, &#x27;invalidState&#x27;, data));
    return;
  }

  if (! this.shard.atHome()) {
    M.log.error(Ose.error(this, &#x27;notAtHome&#x27;, data));
    return;
  }

  if (typeof this.queueStateTimeout === &#x27;number&#x27;) {
    if (this.queueStateHandle) {
      mergeQueue(this.queuedState, data, this.state);
    } else {
      queueState(this, data);
    }
  } else {
    if (updateState(this, data, Ose.nextTime(), src || Ose.name) &amp;&amp; this.slaves) {
      this.broadcast({
        srev: this.srev,
        state: data,
      });
    }
  }

  return;
};

exports.inView = function(params) {  // {{{2
/**
 * Tests whether entry belongs to view.
 *
 * TODO: Consider renaming method to isInView.
 *
 * @param params {Object} Object containing parameters
 *
 * @return {Boolean}
 *
 * @method inView
 */

  if (! this.kind) {
    M.log.unhandled(&#x27;Invalid this.kind&#x27;, this.shard.alias, this.id);
  }

  if (params.kind &amp;&amp; (this.kind.name !== params.kind)) return false;

  if (params.filter) {
    if (params.filter.master &amp;&amp; this.data.master !== params.filter.master) return false;
    if (params.filter.parent &amp;&amp; this.data.parent !== params.filter.parent) return false;
  }

  if (this.kind.inView) {
    return this.kind.inView(this, params);
  }

  return true;
};

exports.isIdentified = function(data) {  // {{{2
/**
 * Tests whether entry is identified by data.
 *
 * @param data {Object} Entry identification
 *
 * @return {Boolean}
 *
 * @method isIdentified
 */

  if (! this.shard.isIdentified(data)) return false;

  if (this.id !== data.entry) return false;

  return true;
};

exports.identify = function() {  // {{{2
/**
 * Returns identification object
 *
 * @return {Object} Identification object
 *
 * @method identify
 */

  return {
    space: this.shard.space.name,
    shard: this.shard.sid,
    entry: this.id
  };
};

exports.isSynced = function(what) {  // {{{2
/**
 * Checks whether data or state are synced
 *
 * @param what {String|Null} What to check (&quot;data&quot;|&quot;state&quot;|Null)
 *
 * @returns {Boolean}
 *
 * @method isSynced
 */

  if (this.shard.atHome()) {
    return true;
  }

  switch (what) {
    case undefined:
    case null:
      return Boolean(this.synced);
    case &#x27;data&#x27;:
      return Boolean(this.synced &amp;&amp; this.dtc);
    case &#x27;state&#x27;:
      return Boolean(this.synced &amp;&amp; this.stc);
    default:
      M.log.unhandled(&#x27;Invalid sync&#x27;, what);
      return false;
  }
};

exports.linkTo = function(entry, req, socket) {  // {{{2
/**
 * Establishes a link to a target entry. When &#x60;req&#x60; contains a track
 * request, the target entry will establish a link to the [home].
 *
 * @param entry {Object|String|Number} Target entry identification
 *
 * @param req {Object|String} Request object
 * @param req.drev {Object} Current data revision. Specifies whether to request entry data.
 * @param req.dtrack {Boolean} Whether to track data changes
 * @param req.srev {Object} Current state revision. Specifies whether to request entry state.
 * @param req.strack {Boolean} Whether to track state changes
 *
 * @param socket {Object|Function(err, entry)} Socket to be linked as a slave to an entry, or a callback with an entry as a response.
 *
 * @async
 * @method linkTo
 */

//  console.log(&#x27;ENTRY LINK&#x27;, entry, req, typeof socket);
//  console.trace();

  switch (typeof entry) {
  case &#x27;string&#x27;:
  case &#x27;number&#x27;:
    this.shard.link(entry, req, socket);
    return;
  case &#x27;object&#x27;:
    this.shard.findShard(entry, function(err, shard) {
      if (err) {
        Ose.link.error(socket, err);
        return;
      }

      shard.link(entry.entry, req, socket);
      return;
    });
    return;
  }

  Ose.link.error(socket, Ose.error(this, &#x27;invalidArgs&#x27;, arguments));
  return;
};

exports.find = function(req, cb) {  // {{{2
/**
 * Finds a sibling entry.
 *
 * @param req {Object|String|Number} Entry identification
 * @param cb {Function (err, shard)} Callback
 *
 * @async
 * @method find
 */

  switch (typeof req) {
  case &#x27;number&#x27;:  // &#x60;req&#x60; is at same &#x60;shard&#x60; and is identified by &#x60;id&#x60;
  case &#x27;string&#x27;:  // &#x60;req&#x60; is at same &#x60;shard&#x60; and is identified by &#x60;id&#x60;
    this.shard.get(req, cb);
    return;
  case &#x27;object&#x27;:  // &#x60;req&#x60; is some object
    this.findShard(req, function(err, shard) {
      if (err) {
        cb(err);
        return;
      }

      shard.get(req.entry, cb);
    });
    return;
  }

  throw Ose.error(this, &#x27;invalidArgs&#x27;, arguments);
};

exports.findShard = function(req, cb) {  // {{{2
/**
 * Finds a sibling shard based on an entry&#x27;s identification.
 *
 * @param req {Object|String|Number} Entry identification
 * @param cb {Function (err, shard)} Callback
 *
 * @async
 * @method findShard
 */

//  console.log(&#x27;ENTRY FIND SHARD&#x27;, {req: req});

  switch (typeof req) {
  case &#x27;string&#x27;:
  case &#x27;number&#x27;:  // req is not an object and points to the same shard.
    cb(null, this.shard);
    return;
  case &#x27;object&#x27;:
    if (req) {
      this.shard.findShard(req, cb);
      return;
    }
    cb(Ose.error(this, &#x27;SHARD_NOT_FOUND&#x27;, req));
    return;
  }

  cb(Ose.error(this, &#x27;invalidArgs&#x27;, arguments));
};

exports.setSynced = function(val) {  // {{{2
/**
 * Sets &#x60;synced&#x60; property and emits &#x60;&quot;synced&quot;&#x60; event.
 *
 * @param val {Boolean} Value to be set
 *
 * @method setSynced
 */

  if (this.synced === val) {
    return;
  }

  this.synced = val;
  this.emit(&#x27;synced&#x27;, val);

  return;
};

exports.update = function(req, full) {  // {{{2
/**
 * Updates this entry based on &#x60;req&#x60;. Called at a slave entry when
 * &#x60;update&#x60; request from the master is received.
 *
 * @param req {Object} Update object
 * @param req.data {Object} Data update
 * @param req.drev {Object} Data revision
 * @param req.state {Object} State
 * @param req.srev {Object} State revision
 * @param req.synced {Boolean} Whether the entry is synced with home
 *
 * @param full {Boolean} Whether the update contain full data or the difference only
 *
 * @method update
 */

  if (&#x27;drev&#x27; in req) {
    this.drev = req.drev;
    this.data = req.data;
//    this.updateData(req.data, req.drev);
  }

  if ((&#x27;srev&#x27; in req) &amp;&amp; (req.srev !== this.srev)) {
    if (full) {
      diff(req.state, this.state);
    }
    updateState(this, req.state, req.srev);
  }

  if (&#x27;synced&#x27; in req) {
    this.setSynced(req.synced);
  }
};

exports.broadcast = function(req) {  // {{{2
/**
 * Broadcasts an entry update request to slaves
 *
 * @param req {Object} Request object
 *
 * @method broadcast
 */
//  console.log(&#x27;ENTRY BROADCAST&#x27;, JSON.stringify(req));

  for (var key in this.slaves) {
    var s = this.slaves[key];
    if (! s.link) continue;

    var d = {};

    if (&#x27;kind&#x27; in req) {
      d.kind = req.kind;
    }

    if (&#x27;synced&#x27; in req) {
      d.synced = req.synced;
    }

    if (s.dtrack &amp;&amp; (&#x27;drev&#x27; in req)) {
      d.drev = req.drev;
      d.data = req.data;
    }

    if (s.strack &amp;&amp; (&#x27;srev&#x27; in req)) {
      d.srev = req.srev;
      d.state = req.state;
    }

    if (! Ose._.isEmpty(d)) {
      s.link.update(req);
    }
  }
};

exports.linkSlave = function(req, socket) {  // {{{2
/**
 * Links a [slave entry client socket]
 *
 * @param req {Object} Request data
 * @param socket {Object} Client socket
 *
 * @method linkSlave
 */

//  console.log(&#x27;ENTRY LINK SLAVE&#x27;, this.id, req);

  if (req.dtrack || req.strack) {
    new Master(this, req, socket);
    return;
  }

  // Request is not tracking data or state, respond with &#x60;close()&#x60;.
  if (! this.kind) {
    Ose.link.error(socket, M.log.todo(&#x27;Trying to get entry data while entry is not setup yet!&#x27;, this));
    return;
  }

  // TODO: p1 =&gt; p2 =&gt; p3;  p1 request entry data and p2 can respond old data when there is no link between p2 entry and p3 entry.
  Ose.link.close(socket, this.respond(req));
  return;
};

exports.linkMaster = function(cb) {  // {{{2
/**
 * Establishes a link to the master entry.
 *
 * Calls &#x60;cb(err, entry)&#x60; after a entry has a defined kind and data.
 *
 * @param cb {Function} Callback
 *
 * @method linkMaster
 * @async
 */

//  console.log(&#x27;ENTRY LINK MASTER&#x27;, {entry: this.id, master: typeof this.master, cb: typeof cb});

  if (this.master) {
    if (! cb) return;

    if (this.master.link &amp;&amp; this.kind) {
      cb(null, this);
      return;
    }

    if (this.master._state !== &#x27;WAIT&#x27;) {
      throw Ose.error(this, &#x27;UNEXPECTED&#x27;, &#x27;&#x60;entry.master&#x60; socket is not waiting for open and is not opened&#x27;, this.master._state);
    }

    this.master.once(&#x27;done&#x27;, cb);
    return;
  }

  var that = this;
  this.master = new Slave(this);

  this.shard.linkMaster(function(err, sm) {
//    console.log(&#x27;ENTRY LINK MASTER RESPONSE&#x27;, err &amp;&amp; err.code);

    if (err) {
      Ose.link.error(cb, err);
      Ose.link.error(that.master, err);
      return;
    }

    var req = {
      drev: that.drev
    };

    if (that.dtc) {
      req.dtrack = true;
    }

    if (that.stc) {
      req.strack = true;
      req.srev = that.srev;
    }

    cb &amp;&amp; that.master.once(&#x27;done&#x27;, cb);

    sm.link.entry(
      {
        entry: that.id,
        what: req
      },
      that.master
    );
    return;
  });
};

exports.respond = function(req) {  // {{{2
/**
 * Creates a response with &#x60;entry.data&#x60; or &#x60;entry.state&#x60; depending on
 * &#x60;req&#x60;
 *
 * @param req {Object} Request object
 *
 * @returns {Object} Response object
 *
 * @method respond
 */
  if (! this.kind) {
    return {
      id: this.id,  // TODO remove &#x60;id&#x60; from communication, it&#x27;s unnecessary.
      synced: false,
    };
  }

  var resp = {
    id: this.id,
    synced: this.synced
  };

  if ((&#x27;drev&#x27; in req) &amp;&amp; (req.drev !== this.drev)) {
    if (req.drev === 0) {
      resp.kind = this.kind.name;
    }

    resp.drev = this.drev;
    resp.data = this.data;
  }

  if ((&#x27;srev&#x27; in req) &amp;&amp; (req.srev !== this.srev)) {
    resp.srev = this.srev;
    resp.state = this.state;
  }

//  console.log(&#x27;RESPOND&#x27;, req, resp);

  return resp;
};

exports.track = function(data, state, cb) {  // {{{2
/**
 * Method called when data or state changes should be tracked.
 *
 * @param data {Object}
 * @param state {Object}
 * @param [cb] {Function} Function to be called after setup tracking.
 *
 * @method tracked
 */

  this.dtc += data;
  this.stc += state;

  if (this.dtc &lt; 0) {
    cb &amp;&amp; cb(Ose.error(this, &#x27;INVALID_DATA_TRACK_COUNT&#x27;, {dtc: this.dtc, data: data}));
    return;
  }

  if (this.stc &lt; 0) {
    cb &amp;&amp; cb(Ose.error(this, &#x27;INVALID_STATE_TRACK_COUNT&#x27;, {stc: this.stc, state: state}));
    return;
  }

//  console.log(&#x27;ENTRY TRACK&#x27;, this.id, &#x27;sum: &#x27;, {data: this.dtc, state: this.stc}, &#x27;change: &#x27;, {data: data, state: state});

  if (this.shard.atHome()) {
    cb &amp;&amp; cb(null);
    return;
  }

  if (this.master &amp;&amp; this.master.link) {  // this has active master, try to send track update.
    var req = {};
    if (this.dtc) {
      if (this.dtc === data) {  // Data tracking changed.
        req.dtrack = true;
        req.drev = this.drev;
      }
    } else {
      req.dtrack = false;
    }

    if (this.stc) {
      if (this.stc === state) {  // State tracking changed.
        req.strack = true;
        req.srev = this.srev;
      }
    } else {
      req.strack = false;
    }

    if (! Ose._.isEmpty(req)) {
      this.master.link.track(req);
    }

    cb &amp;&amp; cb(null);
    return;
  }

  this.linkMaster(function(err) {  // Entry has no active link to the master, establish it if possible.
//    console.log(&#x27;ENTRY TRACK RESPONSE&#x27;, err &amp;&amp; err.code);

    if (err) {
      cb &amp;&amp; cb(err);
    } else {
      cb &amp;&amp; cb();
    }
  });
  return;
};

// }}}1
// Private {{{1
function setupHome(that) {  // {{{2
  if (! that.drev) {
    that.drev = 1;
  }

  if (! that.srev) {
    that.srev = Ose.nextTime();
  }

  if (that.homeInit) {
    switch (typeof that.homeInit) {
    case &#x27;function&#x27;:
      break;
    case &#x27;string&#x27;:
      if (that.homeInit.match(/^\.\//)) {
        that.homeInit = that.M.requireChain(that.homeInit);
      } else {
        that.homeInit = require(that.homeInit);
      }
      break;
    case &#x27;boolean&#x27;:
      that.homeInit = that.M.requireChain(&#x27;./home&#x27;);
      break;
    default:
      throw Ose.error(that, &#x27;invalidHomeInit&#x27;, that.homeInit);
    }

    if (typeof that.homeInit === &#x27;string&#x27;) {
      require(that.homeInit)(that);
    } else {
      that.homeInit();
    }
  }

  if (that.kind.homeInit) {
    switch (typeof that.kind.homeInit) {
    case &#x27;function&#x27;:
      break;
    case &#x27;string&#x27;:
      if (that.kind.homeInit.match(/^\.\//)) {
        that.kind.homeInit = that.kind.M.requireChain(that.kind.homeInit);
      } else {
        that.kind.homeInit = require(that.kind.homeInit);
      }
      break;
    case &#x27;boolean&#x27;:
      that.kind.homeInit = that.kind.M.requireChain(&#x27;./home&#x27;);
      break;
    default:
      throw Ose.error(that.kind, &#x27;invalidHomeInit&#x27;, that.kind.homeInit);
    }

    that.kind.homeInit(that);
  }

  that.setSynced(true);

  that.slaves &amp;&amp; that.broadcast({
    kind: that.kind.name,
    synced: true,
    drev: that.drev,
    data: that.data,
    srev: that.srev,
    state: that.state,
  });
};

function updateState(that, data, rev, src) {  // Entry state changed. Update &quot;state&quot; and &quot;srev&quot;. &quot;data&quot; are altered (unchanged keys are removed). Return false if there is nothing to update. {{{2

//  console.log(&#x27;ENTRY UPDATE STATE&#x27;, data, that.state);

  if (typeof data !== &#x27;object&#x27;) {
    M.log.unhandled(&#x27;State must be an object.&#x27;, data)
    return false;
  }

  var orev = that.srev;
  that.srev = rev;

  clean(data, that.state);
  if (Ose._.isEmpty(data)) return false;

  if (! that.state) that.state = {};
  merge(that.state, data);

  M.log.debug(&#x27;State changed&#x27;, JSON.stringify({entry: that.id, state: data}));

  that.emit(&#x27;state&#x27;, data);

  return true;
};

function queueState(that, data) {  // {{{2
  if (that.queuedState) {
    M.log.unhandled(&#x27;State is already queued&#x27;, that.queuedState);
    return;
  }

  that.queuedState = data;

  that.queueStateHandle = setTimeout(function() {
    var state = that.queuedState;

    delete that.queueStateHandle;
    delete that.queuedState;

    if (updateState(that, state, Ose.nextTime(), Ose.name) &amp;&amp; that.slaves) {
      that.broadcast({
        srev: that.srev,
        state: state,
      });
    }
  }, that.queueStateTimeout);
};

function clean(data, orig) {  // Alter &quot;data&quot; - remove properties that are same as in &quot;orig&quot;. {{{2
//  console.log(&#x27;CLEAN&#x27;, orig, data);

  if (! orig) return;
  if (typeof orig !== &#x27;object&#x27;) return;

  for (var key in data) {
    var value = data[key];

    if (key in orig) {  // Key is found in original data.
      if (value === null) continue;  // Value from orig will be deleted.

      if (value === undefined) {  // Value in orig will be kept.
        delete data[key];
        continue;
      }

      if (Ose._.isEqual(value, orig[key])) {
        delete data[key];  // Values are same, remove the key.
        continue;
      }

      if (Array.isArray(value)) continue;  // Array is different, keep the key.

      if (typeof value === &#x27;object&#x27;) {
        clean(value, orig[key]);

        for (var kex in value) if (value[kex] !== null) {  // Find if there remain some non null property in cleaned &quot;value&quot;.
          value = null;
          break;
        }

        if (value !== null) delete data[key];  // Delete key from cleaned, when there is no non null property.
      }
    } else { // Key is not found in original data.
      switch (value) {
      case undefined:
      case null:
        delete data[key];
      }
    }
  }

  return;
};

function diff(data, orig) {  // Alter &quot;data&quot;: set keys not existing in &quot;orig&quot; to null. {{{2
//  console.log(&#x27;DIFF&#x27;, data, orig);

  if ((typeof data !== &#x27;object&#x27;) || (typeof orig !== &#x27;object&#x27;)) {
    return data === orig;
  }

  for (var key in orig) {
    if (key in data) {
      if (diff(data[key], orig[key])) {
        delete data[key];
      }
    } else {
      data[key] = null;
    }
  }

//  console.log(&#x27;DIFF RESPONSE&#x27;, data);

  return false;
};

function merge(data, change) {  // Alter &quot;data&quot; by &quot;change&quot;, return data. {{{2
  for (var key in change) {
    var value = change[key];

    if (value === null) {
      delete data[key];
      continue;
    }

    if ((typeof value === &#x27;object&#x27;) &amp;&amp; (key in data)) {
      merge(data[key], value);
      continue;
    }

    data[key] = value;
  }

  return data;
};

function mergeClean(dst, src, orig) {  // {{{2
  for (var key in orig) {
    if (key in src) {
      if (typeof orig[key] === &#x27;object&#x27;) {
        mergeClean(dst[key] = {}, src[key], orig[key])
      } else {
        dst[key] = src[key];
      }
    } else {
      dst[key] = null;
    }
  }

  for (var key in src) {
    if (! (key in orig)) {
      dst[key] = src[key];
    }
  }
};

function mergeQueue(dst, src, orig) {  // {{{2
  for (var key in src) {
    var value = src[key];

    if (value === null) {
      dst[key] = null;
      continue;
    }

    if ((typeof value === &#x27;object&#x27;) &amp;&amp; (dst[key])) {
      mergeQueue(dst[key], value, orig &amp;&amp; orig[key]);
      continue;
    }

    if ((dst[key] === null) &amp;&amp; orig &amp;&amp; (typeof orig[key] === &#x27;object&#x27;)) {
      mergeClean(dst[key] = {}, value, orig[key]);
    } else {
      dst[key] = value;
    }
  }
};

// }}}1

</pre>

</div>
      </div>

    </div>
  </div>
  <script src="../assets/vendor/prettify/prettify-min.js"></script>
  <script>prettyPrint();</script>
  <script src="../assets/js/yui-prettify.js"></script>
  <!--script src="../assets/js/tabs.js"></script-->
  <script src="../assets/js/ose.js"></script>
</body>
</html>
