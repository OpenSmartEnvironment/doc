<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>../ose/lib/index.js - ose-bundle</title>
  <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
  <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
  <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
  <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/zepto/1.1.4/zepto.min.js"></script>
</head>
<body class="yui3-skin-sam">

  <div id="doc">
    <div class="yui3-g">

      <div id="sidebar" class="yui3-u">
        <a href="../index.html"><h2>OSE documentation</h2></a>

        <div class="sidebox">
          <div class="hd">
            <h2 class="no-toc">Type to filter sidebar:</h2>
          </div>
          <div class="bd">
            <input id="filter-input" />
          </div>
        </div>

        







<div id="modules" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">All packages and components</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../modules/bb.html">bb</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/bb.html#bb.box">bb.box</a></li> -->
                            <li><a href="../modules/bb.box.html">bb.box</a></li>
                        
                            <!-- <li><a href="../modules/bb.html#bb.dialog">bb.dialog</a></li> -->
                            <li><a href="../modules/bb.dialog.html">bb.dialog</a></li>
                        
                            <!-- <li><a href="../modules/bb.html#bb.pagelet">bb.pagelet</a></li> -->
                            <li><a href="../modules/bb.pagelet.html">bb.pagelet</a></li>
                        
                            <!-- <li><a href="../modules/bb.html#bb.widget">bb.widget</a></li> -->
                            <li><a href="../modules/bb.widget.html">bb.widget</a></li>
                        
                            <!-- <li><a href="../modules/bb.html#bb.stateObj">bb.stateObj</a></li> -->
                            <li><a href="../modules/bb.stateObj.html">bb.stateObj</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/boards.html">boards</a>
                
                </li>
            
                <li><a href="../modules/bundle.html">bundle</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/bundle.html#bundle.media">bundle.media</a></li> -->
                            <li><a href="../modules/bundle.media.html">bundle.media</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/control.html">control</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/control.html#control.distributor">control.distributor</a></li> -->
                            <li><a href="../modules/control.distributor.html">control.distributor</a></li>
                        
                            <!-- <li><a href="../modules/control.html#control.pin">control.pin</a></li> -->
                            <li><a href="../modules/control.pin.html">control.pin</a></li>
                        
                            <!-- <li><a href="../modules/control.html#control.room">control.room</a></li> -->
                            <li><a href="../modules/control.room.html">control.room</a></li>
                        
                            <!-- <li><a href="../modules/control.html#control.remote">control.remote</a></li> -->
                            <li><a href="../modules/control.remote.html">control.remote</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/dvb.html">dvb</a>
                
                </li>
            
                <li><a href="../modules/fs.html">fs</a>
                
                </li>
            
                <li><a href="../modules/icecast.html">icecast</a>
                
                </li>
            
                <li><a href="../modules/lirc.html">lirc</a>
                
                </li>
            
                <li><a href="../modules/media.html">media</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/media.html#media.history">media.history</a></li> -->
                            <li><a href="../modules/media.history.html">media.history</a></li>
                        
                            <!-- <li><a href="../modules/media.html#media.player">media.player</a></li> -->
                            <li><a href="../modules/media.player.html">media.player</a></li>
                        
                            <!-- <li><a href="../modules/media.html#media.stream">media.stream</a></li> -->
                            <li><a href="../modules/media.stream.html">media.stream</a></li>
                        
                            <!-- <li><a href="../modules/media.html#media.source">media.source</a></li> -->
                            <li><a href="../modules/media.source.html">media.source</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/ose.html">ose</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/ose.html#ose.data">ose.data</a></li> -->
                            <li><a href="../modules/ose.data.html">ose.data</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.http">ose.http</a></li> -->
                            <li><a href="../modules/ose.http.html">ose.http</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.peer">ose.peer</a></li> -->
                            <li><a href="../modules/ose.peer.html">ose.peer</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.link">ose.link</a></li> -->
                            <li><a href="../modules/ose.link.html">ose.link</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.logger">ose.logger</a></li> -->
                            <li><a href="../modules/ose.logger.html">ose.logger</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.plugin">ose.plugin</a></li> -->
                            <li><a href="../modules/ose.plugin.html">ose.plugin</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.wrap">ose.wrap</a></li> -->
                            <li><a href="../modules/ose.wrap.html">ose.wrap</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/pa.html">pa</a>
                
                </li>
            
                <li><a href="../modules/rpi.html">rpi</a>
                
                </li>
            
                <li><a href="../modules/videolan.html">videolan</a>
                
                </li>
            
                <li><a href="../modules/xorg.html">xorg</a>
                
                </li>
            
                <li><a href="../modules/yoctopuce.html">yoctopuce</a>
                
                </li>
            
                <li><a href="../modules/youtube.html">youtube</a>
                
                </li>
            
        </ul>
    </div>
</div>

<div id="classes" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">All modules</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../classes/bb.content.html">bb.content</a></li>
            
                <li><a href="../classes/bb.lib.html">bb.lib</a></li>
            
                <li><a href="../classes/bb.lib.box.content.html">bb.lib.box.content</a></li>
            
                <li><a href="../classes/bb.lib.box.left.html">bb.lib.box.left</a></li>
            
                <li><a href="../classes/bb.lib.dialog.html">bb.lib.dialog</a></li>
            
                <li><a href="../classes/bb.lib.dialog.action.html">bb.lib.dialog.action</a></li>
            
                <li><a href="../classes/bb.lib.dialog.confirm.html">bb.lib.dialog.confirm</a></li>
            
                <li><a href="../classes/bb.lib.dialog.info.html">bb.lib.dialog.info</a></li>
            
                <li><a href="../classes/bb.lib.dialog.valueSelector.html">bb.lib.dialog.valueSelector</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.html">bb.lib.pagelet</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.dashboard.html">bb.lib.pagelet.dashboard</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.detail.html">bb.lib.pagelet.detail</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.entry.html">bb.lib.pagelet.entry</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.gesture.html">bb.lib.pagelet.gesture</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.list.html">bb.lib.pagelet.list</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.listItem.html">bb.lib.pagelet.listItem</a></li>
            
                <li><a href="../classes/bb.lib.widget.html">bb.lib.widget</a></li>
            
                <li><a href="../classes/bb.lib.widget.button.html">bb.lib.widget.button</a></li>
            
                <li><a href="../classes/bb.lib.widget.checkbox.html">bb.lib.widget.checkbox</a></li>
            
                <li><a href="../classes/bb.lib.widget.list.html">bb.lib.widget.list</a></li>
            
                <li><a href="../classes/bb.lib.widget.listItem.html">bb.lib.widget.listItem</a></li>
            
                <li><a href="../classes/bb.lib.widget.search.html">bb.lib.widget.search</a></li>
            
                <li><a href="../classes/bb.lib.widget.slider.html">bb.lib.widget.slider</a></li>
            
                <li><a href="../classes/bb.lib.widget.slideswitch.html">bb.lib.widget.slideswitch</a></li>
            
                <li><a href="../classes/bb.lib.widget.toolbar.html">bb.lib.widget.toolbar</a></li>
            
                <li><a href="../classes/boards.content.html">boards.content</a></li>
            
                <li><a href="../classes/boards.lib.html">boards.lib</a></li>
            
                <li><a href="../classes/bundle.doc.html">bundle.doc</a></li>
            
                <li><a href="../classes/bundle.example.media.html">bundle.example.media</a></li>
            
                <li><a href="../classes/bundle.examples.media.config.html">bundle.examples.media.config</a></li>
            
                <li><a href="../classes/bundle.Gruntfile.html">bundle.Gruntfile</a></li>
            
                <li><a href="../classes/control.content.html">control.content</a></li>
            
                <li><a href="../classes/control.lib.html">control.lib</a></li>
            
                <li><a href="../classes/control.lib.activity.html">control.lib.activity</a></li>
            
                <li><a href="../classes/control.lib.din.html">control.lib.din</a></li>
            
                <li><a href="../classes/control.lib.din.pin.html">control.lib.din.pin</a></li>
            
                <li><a href="../classes/control.lib.distributor.html">control.lib.distributor</a></li>
            
                <li><a href="../classes/control.lib.door.html">control.lib.door</a></li>
            
                <li><a href="../classes/control.lib.door.pin.html">control.lib.door.pin</a></li>
            
                <li><a href="../classes/control.lib.flowMeter.html">control.lib.flowMeter</a></li>
            
                <li><a href="../classes/control.lib.heater.html">control.lib.heater</a></li>
            
                <li><a href="../classes/control.lib.heater.pin.html">control.lib.heater.pin</a></li>
            
                <li><a href="../classes/control.lib.heater.tariff.html">control.lib.heater.tariff</a></li>
            
                <li><a href="../classes/control.lib.light.html">control.lib.light</a></li>
            
                <li><a href="../classes/control.lib.light.pin.html">control.lib.light.pin</a></li>
            
                <li><a href="../classes/control.lib.light.remote.html">control.lib.light.remote</a></li>
            
                <li><a href="../classes/control.lib.light.switch.html">control.lib.light.switch</a></li>
            
                <li><a href="../classes/control.lib.pin.html">control.lib.pin</a></li>
            
                <li><a href="../classes/control.lib.pin.commands.html">control.lib.pin.commands</a></li>
            
                <li><a href="../classes/control.lib.pin.counter.html">control.lib.pin.counter</a></li>
            
                <li><a href="../classes/control.lib.pin.din.html">control.lib.pin.din</a></li>
            
                <li><a href="../classes/control.lib.pin.dout.html">control.lib.pin.dout</a></li>
            
                <li><a href="../classes/control.lib.pin.light.html">control.lib.pin.light</a></li>
            
                <li><a href="../classes/control.lib.pin.list.html">control.lib.pin.list</a></li>
            
                <li><a href="../classes/control.lib.pin.pwm.html">control.lib.pin.pwm</a></li>
            
                <li><a href="../classes/control.lib.pin.switch.html">control.lib.pin.switch</a></li>
            
                <li><a href="../classes/control.lib.remote.html">control.lib.remote</a></li>
            
                <li><a href="../classes/control.lib.room.html">control.lib.room</a></li>
            
                <li><a href="../classes/control.lib.switch.html">control.lib.switch</a></li>
            
                <li><a href="../classes/control.lib.switch.relay.html">control.lib.switch.relay</a></li>
            
                <li><a href="../classes/control.lib.switch.socket.html">control.lib.switch.socket</a></li>
            
                <li><a href="../classes/dvb.content.html">dvb.content</a></li>
            
                <li><a href="../classes/dvb.lib.html">dvb.lib</a></li>
            
                <li><a href="../classes/dvb.lib.channel.html">dvb.lib.channel</a></li>
            
                <li><a href="../classes/fs.content.html">fs.content</a></li>
            
                <li><a href="../classes/fs.lib.html">fs.lib</a></li>
            
                <li><a href="../classes/fs.lib.dir.html">fs.lib.dir</a></li>
            
                <li><a href="../classes/fs.lib.file.html">fs.lib.file</a></li>
            
                <li><a href="../classes/icecast.content.html">icecast.content</a></li>
            
                <li><a href="../classes/icecast.lib.html">icecast.lib</a></li>
            
                <li><a href="../classes/icecast.lib.stream.html">icecast.lib.stream</a></li>
            
                <li><a href="../classes/lirc.content.html">lirc.content</a></li>
            
                <li><a href="../classes/lirc.lib.html">lirc.lib</a></li>
            
                <li><a href="../classes/lirc.lib.lirc.html">lirc.lib.lirc</a></li>
            
                <li><a href="../classes/media.content.html">media.content</a></li>
            
                <li><a href="../classes/media.lib.html">media.lib</a></li>
            
                <li><a href="../classes/media.lib.item.html">media.lib.item</a></li>
            
                <li><a href="../classes/media.lib.player.html">media.lib.player</a></li>
            
                <li><a href="../classes/media.lib.player.commands.html">media.lib.player.commands</a></li>
            
                <li><a href="../classes/media.lib.player.dvb.html">media.lib.player.dvb</a></li>
            
                <li><a href="../classes/media.lib.player.playback.html">media.lib.player.playback</a></li>
            
                <li><a href="../classes/media.lib.player.volume.html">media.lib.player.volume</a></li>
            
                <li><a href="../classes/media.lib.sources.html">media.lib.sources</a></li>
            
                <li><a href="../classes/media.lib.stream.html">media.lib.stream</a></li>
            
                <li><a href="../classes/ose.content.html">ose.content</a></li>
            
                <li><a href="../classes/ose.core.html">ose.core</a></li>
            
                <li><a href="../classes/ose.lib.browser.html">ose.lib.browser</a></li>
            
                <li><a href="../classes/ose.lib.cli.html">ose.lib.cli</a></li>
            
                <li><a href="../classes/ose.lib.counter.html">ose.lib.counter</a></li>
            
                <li><a href="../classes/ose.lib.entry.html">ose.lib.entry</a></li>
            
                <li><a href="../classes/ose.lib.entry.link.html">ose.lib.entry.link</a></li>
            
                <li><a href="../classes/ose.lib.entry.master.html">ose.lib.entry.master</a></li>
            
                <li><a href="../classes/ose.lib.entry.slave.html">ose.lib.entry.slave</a></li>
            
                <li><a href="../classes/ose.lib.http.html">ose.lib.http</a></li>
            
                <li><a href="../classes/ose.lib.http.content.html">ose.lib.http.content</a></li>
            
                <li><a href="../classes/ose.lib.kind.html">ose.lib.kind</a></li>
            
                <li><a href="../classes/ose.lib.link.html">ose.lib.link</a></li>
            
                <li><a href="../classes/ose.lib.logger.html">ose.lib.logger</a></li>
            
                <li><a href="../classes/ose.lib.node.html">ose.lib.node</a></li>
            
                <li><a href="../classes/ose.lib.peer.here.html">ose.lib.peer.here</a></li>
            
                <li><a href="../classes/ose.lib.peer.list.html">ose.lib.peer.list</a></li>
            
                <li><a href="../classes/ose.lib.peer.remote.html">ose.lib.peer.remote</a></li>
            
                <li><a href="../classes/ose.lib.peer.rx.html">ose.lib.peer.rx</a></li>
            
                <li><a href="../classes/ose.lib.plugins.html">ose.lib.plugins</a></li>
            
                <li><a href="../classes/ose.lib.scope.html">ose.lib.scope</a></li>
            
                <li><a href="../classes/ose.lib.shard.html">ose.lib.shard</a></li>
            
                <li><a href="../classes/ose.lib.shard.master.html">ose.lib.shard.master</a></li>
            
                <li><a href="../classes/ose.lib.shard.slave.html">ose.lib.shard.slave</a></li>
            
                <li><a href="../classes/ose.lib.space.html">ose.lib.space</a></li>
            
                <li><a href="../classes/ose.lib.space.list.html">ose.lib.space.list</a></li>
            
                <li><a href="../classes/ose.lib.ws.html">ose.lib.ws</a></li>
            
                <li><a href="../classes/ose.lib.ws.browser.html">ose.lib.ws.browser</a></li>
            
                <li><a href="../classes/ose.lib.ws.master.html">ose.lib.ws.master</a></li>
            
                <li><a href="../classes/ose.lib.ws.node.html">ose.lib.ws.node</a></li>
            
                <li><a href="../classes/ose.lib.ws.relay.html">ose.lib.ws.relay</a></li>
            
                <li><a href="../classes/ose.lib.ws.slave.html">ose.lib.ws.slave</a></li>
            
                <li><a href="../classes/ose.wrap.class.html">ose.wrap.class</a></li>
            
                <li><a href="../classes/ose.wrap.common.html">ose.wrap.common</a></li>
            
                <li><a href="../classes/ose.wrap.module.html">ose.wrap.module</a></li>
            
                <li><a href="../classes/ose.wrap.package.html">ose.wrap.package</a></li>
            
                <li><a href="../classes/ose.wrap.singleton.html">ose.wrap.singleton</a></li>
            
                <li><a href="../classes/pa.content.html">pa.content</a></li>
            
                <li><a href="../classes/pa.lib.html">pa.lib</a></li>
            
                <li><a href="../classes/pa.lib.dbus.html">pa.lib.dbus</a></li>
            
                <li><a href="../classes/rpi.content.html">rpi.content</a></li>
            
                <li><a href="../classes/rpi.lib.html">rpi.lib</a></li>
            
                <li><a href="../classes/rpi.lib.camera.html">rpi.lib.camera</a></li>
            
                <li><a href="../classes/rpi.lib.rpi.html">rpi.lib.rpi</a></li>
            
                <li><a href="../classes/videolan.content.html">videolan.content</a></li>
            
                <li><a href="../classes/videolan.lib.html">videolan.lib</a></li>
            
                <li><a href="../classes/videolan.lib.dvblast.html">videolan.lib.dvblast</a></li>
            
                <li><a href="../classes/videolan.lib.dvblast.master.html">videolan.lib.dvblast.master</a></li>
            
                <li><a href="../classes/videolan.lib.vlc.html">videolan.lib.vlc</a></li>
            
                <li><a href="../classes/xorg.content.html">xorg.content</a></li>
            
                <li><a href="../classes/xorg.lib.html">xorg.lib</a></li>
            
                <li><a href="../classes/xorg.lib.xorg.html">xorg.lib.xorg</a></li>
            
                <li><a href="../classes/yoctopuce.content.html">yoctopuce.content</a></li>
            
                <li><a href="../classes/yoctopuce.lib.html">yoctopuce.lib</a></li>
            
                <li><a href="../classes/yoctopuce.lib.meteo.html">yoctopuce.lib.meteo</a></li>
            
                <li><a href="../classes/youtube.content.html">youtube.content</a></li>
            
                <li><a href="../classes/youtube.lib.html">youtube.lib</a></li>
            
                <li><a href="../classes/youtube.lib.video.html">youtube.lib.video</a></li>
            
        </ul>
    </div>
</div>


      </div>

      <div id="main" class="yui3-u">
        <div class="content"><h4>../ose/lib/index.js</h4>

<pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

// Require is in browser available after calling Ose.setup

var Ose = exports;
var M;  // This package wrapper; defined during &#x60;setup()&#x60;

/** Docs {{{1
 * @caption Open Smart Environment framework
 *
 * @readme
 * Lightweight and extensible framework for development and rapid
 * prototyping of modern applications based on Node.js and HTML5.
 *
 * The framework is created as a base for an OSE application that
 * manages the physical and virtual environment that a user lives
 * in. It brings the ability to easily monitor and control the
 * environment, and to automate tasks.
 *
 * @features
 * - Multi-instance architecture
 * - Transparent network communication via WebSockets
 * - Near real-time synchronization
 * - Code sharing between Node.js and web browsers
 * - Partitioned data model
 * - Extensible via npm packages
 *
 *
 * @description
 *
 * ## Platforms
 *
 * We are developing the OSE framework on the following platforms and
 * browsers:
 * - Node.js (&gt;0.10) running on Debian Jessie and Raspbian
 * - recent versions of Firefox
 * - recent versions of Chromium/Chrome
 *
 * It, however, probably also runs on other recent Linux
 * distributions.
 *
 *
 * @planned
 * TODO
 * - User-based authentication
 * - Automate backups and deployment
 * - Deeper integration into Firefox OS and other environments
 * - Socialization
 * - Integration with other Free Software
 * - Integration with on-line services
 *
 * @keywords
 * TODO
 * javascript, nodejs, framework, webapp, distributed
 *
 * @aliases framework oseFramework supportedBrowser supportedBrowsers
 *
 * @module ose
 * @main ose
 */

/**
 * @caption OSE core
 *
 * @readme
 * Most modules use the &#x60;OSE core&#x60; singleton by calling &#x60;var Ose = require(&#x27;ose&#x27;)&#x60;.
 *
 * @class ose.core
 * @type singleton
 * @main ose.core
 */

// Public {{{1
exports.classes = {};  // {{{2
/**
 * Predefined class names and constructors
 *
 * @property classes
 * @type Object
 */

exports.setup = function(runtime) {  // {{{2
/**
 * Sets up OSE framework
 *
 * @param runtime {String} (&#x60;&quot;browser&quot;&#x60; | &#x60;&quot;node&quot;&#x60;) Runtime environment
 *
 * @method setup
 */

  this.lastTime = 0;
  this.runtime = runtime;

  this._ = require(&#x27;underscore&#x27;);  // TODO document _ and _s properties
  this._s = require(&#x27;underscore.string&#x27;);
  this.dia = require(&#x27;diacritics&#x27;).remove;  // {{{3
  /**
   * Return new string based on &#x60;val&#x60; with diacriticts transformed to ascii.
   *
   * @param val {String} Value to transform.
   *
   * @return {String} Transformed string.
   *
   * @method dia
   */
  // }}}3

  var w = require(&#x27;./wrap&#x27;);

  this.Class = newWrap(&#x27;class&#x27;);
  this.Module = newWrap(&#x27;module&#x27;);
  this.Package = newWrap(&#x27;package&#x27;);
  this.Singleton = newWrap(&#x27;singleton&#x27;);

  M = this.package(module);

  w.setup();

  Counter = M.class(&#x27;./counter&#x27;);
  Scope = M.class(&#x27;./scope&#x27;);

  this.link = require(&#x27;./link&#x27;);
  this.peers = require(&#x27;./peer/list&#x27;);
  this.plugins = require(&#x27;./plugins&#x27;);
  this.scopes = {};
  this.spaces = require(&#x27;./space/list&#x27;);

  M.init();
  M.scope = &#x27;core&#x27;;
  M.kind(&#x27;./peer&#x27;, &#x27;peer&#x27;);
  M.content();

  function newWrap(name) {  // {{{3
    var result = w[name];

    var def = {};

    exports._.extend(def, w.common, w[name + &#x27;Proto&#x27;]);

    result.prototype = Object.create(Object.prototype, def);

    return result;
  }

  // }}}3
};

exports.config = function(name, data) {  // {{{2
/**
 * OSE plugin configuration method.
 *
 * @param data {Object} Configuration data
 *
 * @method config
 */

  if (! data.name) {
    throw Ose.error(&#x27;missingName&#x27;, data);
  }

  this.name = data.name;
  this.peers.config(data.name, data.peers, data.gw);
};

exports.browserConfig = function(config) {  // {{{2
/**
 * Prepare configuration for the browser.
 *
 * @param config {Object} Configuration object
 *
 * @method browserConfig
 */

  if (! this.clientId) this.clientId = 1;

  config.name = this.clientId++ + &#x27;.&#x27; + Ose.now() + &#x27;.&#x27; + this.name;
  config.peer = this.name;
  config.peers = {};
  config.peers[this.name] = &#x27;window.location&#x27;;
  config.gw = this.name;
};

exports.class = function(m, ctor, sup) {  // {{{2
  switch (arguments.length) {
  case 1:
  case 3:
    break;
  case 2:
    if (typeof ctor === &#x27;string&#x27;) {
      sup = ctor;
      ctor = undefined;
    }
    break;
  default:
    throw exports.error(&#x27;invalidArgs&#x27;, arguments);
  }

  return new (this.Class)(m, ctor, sup);
};

exports.module = function(m) {  // {{{2
  return new (this.Module)(m);
};

exports.package = function(m, init) {  // {{{2
  var result = new (this.Package)(m, init);
  if (this.resolvePackage) {
    this.resolvePackage(result);
  }

  return result;
};

exports.singleton = function(m, init, sup) {  // {{{2
  switch (arguments.length) {
  case 1:
  case 3:
    break;
  case 2:
    if (typeof init === &#x27;string&#x27;) {
      sup = init;
      init = undefined;
    }
    break;
  default:
    throw exports.error(&#x27;invalidArgs&#x27;, arguments);
  }

  return new (this.Singleton)(m, init, sup);
};

exports.error = function(subject, code, message, data) {  // {{{2
/**
 * Creates &#x60;Error&#x60; instance and appends a subject and data to it.
 *
 * See [logging].
 *
 * @param [subject] {*} Subject of the error
 * @param code {String} Error code
 * @param [message] {String} Error message
 * @param [data] {Object} Optional data describing error
 */

  if ((typeof subject === &#x27;string&#x27;) &amp;&amp; (arguments.length &lt; 4)) {
    data = message;
    message = code;
    code = subject;
    subject = undefined;
  }

  /*
  if (typeof code !== &#x27;string&#x27;) {
    throw new Error(&#x27;Invalid error code: &#x27; + JSON.stringify(code));
  }
  */

  if (typeof message === &#x27;string&#x27;) {
    if (code) {
      message = code + &#x27;: &#x27; + message;
    }
  } else {
    if (data) {
      if (code) {
        message = code + &#x27;: &#x27; + message.toString();
      } else {
        message = message.toString();
      }
    } else {
      data = message;
      message = code;
    }
  }

  var result = new Error(message);
  result.code = code;
  if (subject) {
    result.subject = subject;
  }
  result.data = data;

  return result;
};

exports.identify = function(subject) {  // {{{2
  if (! subject) return undefined;

  if (subject === this) {
    return {
      module: &#x27;ose&#x27;
    };
  };

  if (subject.identify) {
    return subject.identify();
  }

  if (subject.M) {
    return {
      module: subject.M.module.filename
    };
  }

  var result = {
    identity: &#x27;unidentifed&#x27;,
    type: typeof subject,
  };

  if (typeof subject === &#x27;object&#x27;) {
    if (&#x27;name&#x27; in subject) {
      result.name = subject.name;
    }

    if (&#x27;id&#x27; in subject) {
      result.id = subject.id;
    }

    if (&#x27;lid&#x27; in subject) {
      result.lid = subject.lid;
    }
  }

  result.subject = subject;

  return result;
};

exports.addClass = function(name, ctor) {  // {{{2
/**
 * Add a class constructor &#x60;ctor&#x60; into predefined &#x60;classes&#x60;.
 *
 * @param name {String} Class name
 * @param ctor {Function} Class constructor
 *
 * @method addClass
 */

  this.classes[name] = ctor;
};

exports.now = function() {  // {{{2
  return new Date().getTime() * 1000;
};

exports.getLocale = function() {  // TODO: Obtain locale from HTTP header instead. {{{2
  var result;

  if (window.navigator.language) {  // Firefox, Opera and Chromium
    result = window.navigator.language;
  } else if (navigator.browserLanguage) {  // IE
    result = navigator.browserLanguage;
  }

  return result;
};

exports.nextTime = function() {  // {{{2
/**
 * Return current time in unix timestamp format in microseconds
 *
 * @return {Number} Current timestamp in microseconds
 *
 * @method getTime
 */

  var result = this.now();

  if (result &gt; this.lastTime) {
    return this.lastTime = result;
  }

  return ++this.lastTime;
};

exports.parseBool = function(val) {  // {{{2
/**
 * Parses booleans
 *
 * @param val {undefined|null|String|Number|Boolean} Value to parse
 *
 * @return {Boolean}
 *
 * @method parseBool
 */

  switch (typeof val) {
  case &#x27;null&#x27;:
  case &#x27;undefined&#x27;:
    return false;
  case &#x27;boolean&#x27;:
    return val;
  case &#x27;number&#x27;:
    return Boolean(val);
  case &#x27;string&#x27;:
    switch (val.toLowerCase()) {
    case &#x27;&#x27;:
    case &#x27;0&#x27;:
    case &#x27;n&#x27;:
    case &#x27;no&#x27;:
    case &#x27;off&#x27;:
    case &#x27;false&#x27;:
      return false;
    case &#x27;1&#x27;:
    case &#x27;y&#x27;:
    case &#x27;yes&#x27;:
    case &#x27;on&#x27;:
    case &#x27;true&#x27;:
      return true;
    }
    throw new Error(&#x27;invalidArgs&#x27;);
  case &#x27;object&#x27;:
    if (! val) return false;
    throw new Error(&#x27;invalidArgs&#x27;);
  }

  throw new Error(&#x27;invalidArgs&#x27;);
};

exports.counter = function(cb) {  // {{{2
/**
 * Creates a new counter. If &quot;cb&quot; is already a counter instance, it only increments it.
 * Counters are used for multiple asynchronous operations with one final callback.
 *
 * @param cb {Function} Final callback
 *
 * @returns {Object} Counter with callback
 *
 * @method counter
 */

  if (M.isSuper(Counter, cb)) {
    cb.inc();
    return cb;
  }

  return new Counter(cb);
};

exports.scope = function(name) {  // {{{2
/**
 * Creates a new scope instance of a given name or returns an existing one.
 *
 * @param name {String} Name of a scope
 *
 * @returns {Object} &#x60;Scope&#x60; instance
 *
 * @method scope
 */

  if (name in this.scopes) {
    return this.scopes[name]
  }

  return this.scopes[name] = new Scope(name);
};

exports.callChain = function(subject, method/*, args*/) {  // {{{2
/**
 * Call all methods with name &quot;method&quot; in &quot;subject&quot;s prototype chain.
 *
 * &quot;method&quot; is called with arguments specified after argument &quot;method&quot;.
 *
 * @param subject {subject}
 * @param method {Function}
 * @param [arg]* {*} Optional arguments to send to subject&#x27;s init function.
 *
 * @method callProtoChain
 */

  var args;
  if (arguments.length &gt; 2) {
    args = Ose._.rest(arguments, 2);
  }

//  console.log(&#x27;CALL PROTO CHAIN&#x27;, subject.className, method, args);

  var p = subject;
  while (p) {
    if (p.hasOwnProperty(method) &amp;&amp; (typeof p[method] === &#x27;function&#x27;)) {
//      console.log(&#x27;CALL CHAIN&#x27;, method, p.M &amp;&amp; p.M.module.id);

      p[method].apply(subject, args);
    }
    p = Object.getPrototypeOf(p);
  }
};

exports.dummyFn = function() {};  // {{{2

// }}}1
// Private {{{1
var Counter;
var Scope;

//}}}1

(function() {
  if (typeof window === &#x27;undefined&#x27;) {  // We are not in the browser.
    var node = require(&#x27;./node&#x27;);

    if (require.main === module) {  // This module is directly called from Node.js.
      node.run();
    }
  }
})();


</pre>

</div>
      </div>

    </div>
  </div>
  <script src="../assets/vendor/prettify/prettify-min.js"></script>
  <script>prettyPrint();</script>
  <script src="../assets/js/yui-prettify.js"></script>
  <!--script src="../assets/js/tabs.js"></script-->
  <script src="../assets/js/ose.js"></script>
</body>
</html>
