<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>../ose/lib/wrap.js - ose-bundle</title>
  <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
  <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
  <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
  <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/zepto/1.1.4/zepto.min.js"></script>
</head>
<body class="yui3-skin-sam">

  <div id="doc">
    <div class="yui3-g">

      <div id="sidebar" class="yui3-u">
        <a href="../index.html"><h2>OSE documentation</h2></a>

        <div class="sidebox">
          <div class="hd">
            <h2 class="no-toc">Type to filter sidebar:</h2>
          </div>
          <div class="bd">
            <input id="filter-input" />
          </div>
        </div>

        







<div id="modules" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">All packages and components</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../modules/bb.html">bb</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/bb.html#bb.box">bb.box</a></li> -->
                            <li><a href="../modules/bb.box.html">bb.box</a></li>
                        
                            <!-- <li><a href="../modules/bb.html#bb.dialog">bb.dialog</a></li> -->
                            <li><a href="../modules/bb.dialog.html">bb.dialog</a></li>
                        
                            <!-- <li><a href="../modules/bb.html#bb.pagelet">bb.pagelet</a></li> -->
                            <li><a href="../modules/bb.pagelet.html">bb.pagelet</a></li>
                        
                            <!-- <li><a href="../modules/bb.html#bb.widget">bb.widget</a></li> -->
                            <li><a href="../modules/bb.widget.html">bb.widget</a></li>
                        
                            <!-- <li><a href="../modules/bb.html#bb.stateObj">bb.stateObj</a></li> -->
                            <li><a href="../modules/bb.stateObj.html">bb.stateObj</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/boards.html">boards</a>
                
                </li>
            
                <li><a href="../modules/bundle.html">bundle</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/bundle.html#bundle.media">bundle.media</a></li> -->
                            <li><a href="../modules/bundle.media.html">bundle.media</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/control.html">control</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/control.html#control.distributor">control.distributor</a></li> -->
                            <li><a href="../modules/control.distributor.html">control.distributor</a></li>
                        
                            <!-- <li><a href="../modules/control.html#control.pin">control.pin</a></li> -->
                            <li><a href="../modules/control.pin.html">control.pin</a></li>
                        
                            <!-- <li><a href="../modules/control.html#control.room">control.room</a></li> -->
                            <li><a href="../modules/control.room.html">control.room</a></li>
                        
                            <!-- <li><a href="../modules/control.html#control.remote">control.remote</a></li> -->
                            <li><a href="../modules/control.remote.html">control.remote</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/dvb.html">dvb</a>
                
                </li>
            
                <li><a href="../modules/fs.html">fs</a>
                
                </li>
            
                <li><a href="../modules/icecast.html">icecast</a>
                
                </li>
            
                <li><a href="../modules/lirc.html">lirc</a>
                
                </li>
            
                <li><a href="../modules/media.html">media</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/media.html#media.history">media.history</a></li> -->
                            <li><a href="../modules/media.history.html">media.history</a></li>
                        
                            <!-- <li><a href="../modules/media.html#media.player">media.player</a></li> -->
                            <li><a href="../modules/media.player.html">media.player</a></li>
                        
                            <!-- <li><a href="../modules/media.html#media.stream">media.stream</a></li> -->
                            <li><a href="../modules/media.stream.html">media.stream</a></li>
                        
                            <!-- <li><a href="../modules/media.html#media.source">media.source</a></li> -->
                            <li><a href="../modules/media.source.html">media.source</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/ose.html">ose</a>
                
                    <ul>
                        
                            <!-- <li><a href="../modules/ose.html#ose.data">ose.data</a></li> -->
                            <li><a href="../modules/ose.data.html">ose.data</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.http">ose.http</a></li> -->
                            <li><a href="../modules/ose.http.html">ose.http</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.peer">ose.peer</a></li> -->
                            <li><a href="../modules/ose.peer.html">ose.peer</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.link">ose.link</a></li> -->
                            <li><a href="../modules/ose.link.html">ose.link</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.logger">ose.logger</a></li> -->
                            <li><a href="../modules/ose.logger.html">ose.logger</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.plugin">ose.plugin</a></li> -->
                            <li><a href="../modules/ose.plugin.html">ose.plugin</a></li>
                        
                            <!-- <li><a href="../modules/ose.html#ose.wrap">ose.wrap</a></li> -->
                            <li><a href="../modules/ose.wrap.html">ose.wrap</a></li>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/pa.html">pa</a>
                
                </li>
            
                <li><a href="../modules/rpi.html">rpi</a>
                
                </li>
            
                <li><a href="../modules/videolan.html">videolan</a>
                
                </li>
            
                <li><a href="../modules/xorg.html">xorg</a>
                
                </li>
            
                <li><a href="../modules/youtube.html">youtube</a>
                
                </li>
            
        </ul>
    </div>
</div>

<div id="classes" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">All modules</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../classes/bb.content.html">bb.content</a></li>
            
                <li><a href="../classes/bb.lib.html">bb.lib</a></li>
            
                <li><a href="../classes/bb.lib.box.content.html">bb.lib.box.content</a></li>
            
                <li><a href="../classes/bb.lib.box.left.html">bb.lib.box.left</a></li>
            
                <li><a href="../classes/bb.lib.dialog.html">bb.lib.dialog</a></li>
            
                <li><a href="../classes/bb.lib.dialog.action.html">bb.lib.dialog.action</a></li>
            
                <li><a href="../classes/bb.lib.dialog.confirm.html">bb.lib.dialog.confirm</a></li>
            
                <li><a href="../classes/bb.lib.dialog.info.html">bb.lib.dialog.info</a></li>
            
                <li><a href="../classes/bb.lib.dialog.valueSelector.html">bb.lib.dialog.valueSelector</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.html">bb.lib.pagelet</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.dashboard.html">bb.lib.pagelet.dashboard</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.detail.html">bb.lib.pagelet.detail</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.entry.html">bb.lib.pagelet.entry</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.gesture.html">bb.lib.pagelet.gesture</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.list.html">bb.lib.pagelet.list</a></li>
            
                <li><a href="../classes/bb.lib.pagelet.listItem.html">bb.lib.pagelet.listItem</a></li>
            
                <li><a href="../classes/bb.lib.widget.html">bb.lib.widget</a></li>
            
                <li><a href="../classes/bb.lib.widget.button.html">bb.lib.widget.button</a></li>
            
                <li><a href="../classes/bb.lib.widget.checkbox.html">bb.lib.widget.checkbox</a></li>
            
                <li><a href="../classes/bb.lib.widget.list.html">bb.lib.widget.list</a></li>
            
                <li><a href="../classes/bb.lib.widget.listItem.html">bb.lib.widget.listItem</a></li>
            
                <li><a href="../classes/bb.lib.widget.search.html">bb.lib.widget.search</a></li>
            
                <li><a href="../classes/bb.lib.widget.slider.html">bb.lib.widget.slider</a></li>
            
                <li><a href="../classes/bb.lib.widget.slideswitch.html">bb.lib.widget.slideswitch</a></li>
            
                <li><a href="../classes/bb.lib.widget.toolbar.html">bb.lib.widget.toolbar</a></li>
            
                <li><a href="../classes/boards.content.html">boards.content</a></li>
            
                <li><a href="../classes/boards.lib.html">boards.lib</a></li>
            
                <li><a href="../classes/bundle.doc.html">bundle.doc</a></li>
            
                <li><a href="../classes/bundle.example.media.html">bundle.example.media</a></li>
            
                <li><a href="../classes/bundle.examples.media.config.html">bundle.examples.media.config</a></li>
            
                <li><a href="../classes/bundle.Gruntfile.html">bundle.Gruntfile</a></li>
            
                <li><a href="../classes/control.content.html">control.content</a></li>
            
                <li><a href="../classes/control.lib.html">control.lib</a></li>
            
                <li><a href="../classes/control.lib.activity.html">control.lib.activity</a></li>
            
                <li><a href="../classes/control.lib.din.html">control.lib.din</a></li>
            
                <li><a href="../classes/control.lib.din.pin.html">control.lib.din.pin</a></li>
            
                <li><a href="../classes/control.lib.distributor.html">control.lib.distributor</a></li>
            
                <li><a href="../classes/control.lib.door.html">control.lib.door</a></li>
            
                <li><a href="../classes/control.lib.door.pin.html">control.lib.door.pin</a></li>
            
                <li><a href="../classes/control.lib.flowMeter.html">control.lib.flowMeter</a></li>
            
                <li><a href="../classes/control.lib.heater.html">control.lib.heater</a></li>
            
                <li><a href="../classes/control.lib.heater.pin.html">control.lib.heater.pin</a></li>
            
                <li><a href="../classes/control.lib.heater.tariff.html">control.lib.heater.tariff</a></li>
            
                <li><a href="../classes/control.lib.light.html">control.lib.light</a></li>
            
                <li><a href="../classes/control.lib.light.pin.html">control.lib.light.pin</a></li>
            
                <li><a href="../classes/control.lib.light.remote.html">control.lib.light.remote</a></li>
            
                <li><a href="../classes/control.lib.light.switch.html">control.lib.light.switch</a></li>
            
                <li><a href="../classes/control.lib.pin.html">control.lib.pin</a></li>
            
                <li><a href="../classes/control.lib.pin.commands.html">control.lib.pin.commands</a></li>
            
                <li><a href="../classes/control.lib.pin.counter.html">control.lib.pin.counter</a></li>
            
                <li><a href="../classes/control.lib.pin.din.html">control.lib.pin.din</a></li>
            
                <li><a href="../classes/control.lib.pin.dout.html">control.lib.pin.dout</a></li>
            
                <li><a href="../classes/control.lib.pin.light.html">control.lib.pin.light</a></li>
            
                <li><a href="../classes/control.lib.pin.list.html">control.lib.pin.list</a></li>
            
                <li><a href="../classes/control.lib.pin.pwm.html">control.lib.pin.pwm</a></li>
            
                <li><a href="../classes/control.lib.pin.switch.html">control.lib.pin.switch</a></li>
            
                <li><a href="../classes/control.lib.remote.html">control.lib.remote</a></li>
            
                <li><a href="../classes/control.lib.room.html">control.lib.room</a></li>
            
                <li><a href="../classes/control.lib.switch.html">control.lib.switch</a></li>
            
                <li><a href="../classes/control.lib.switch.relay.html">control.lib.switch.relay</a></li>
            
                <li><a href="../classes/control.lib.switch.socket.html">control.lib.switch.socket</a></li>
            
                <li><a href="../classes/dvb.content.html">dvb.content</a></li>
            
                <li><a href="../classes/dvb.lib.html">dvb.lib</a></li>
            
                <li><a href="../classes/dvb.lib.channel.html">dvb.lib.channel</a></li>
            
                <li><a href="../classes/fs.content.html">fs.content</a></li>
            
                <li><a href="../classes/fs.lib.html">fs.lib</a></li>
            
                <li><a href="../classes/fs.lib.dir.html">fs.lib.dir</a></li>
            
                <li><a href="../classes/fs.lib.file.html">fs.lib.file</a></li>
            
                <li><a href="../classes/icecast.content.html">icecast.content</a></li>
            
                <li><a href="../classes/icecast.lib.html">icecast.lib</a></li>
            
                <li><a href="../classes/icecast.lib.stream.html">icecast.lib.stream</a></li>
            
                <li><a href="../classes/lirc.content.html">lirc.content</a></li>
            
                <li><a href="../classes/lirc.lib.html">lirc.lib</a></li>
            
                <li><a href="../classes/lirc.lib.lirc.html">lirc.lib.lirc</a></li>
            
                <li><a href="../classes/media.content.html">media.content</a></li>
            
                <li><a href="../classes/media.lib.html">media.lib</a></li>
            
                <li><a href="../classes/media.lib.item.html">media.lib.item</a></li>
            
                <li><a href="../classes/media.lib.player.html">media.lib.player</a></li>
            
                <li><a href="../classes/media.lib.player.commands.html">media.lib.player.commands</a></li>
            
                <li><a href="../classes/media.lib.player.dvb.html">media.lib.player.dvb</a></li>
            
                <li><a href="../classes/media.lib.player.playback.html">media.lib.player.playback</a></li>
            
                <li><a href="../classes/media.lib.player.volume.html">media.lib.player.volume</a></li>
            
                <li><a href="../classes/media.lib.sources.html">media.lib.sources</a></li>
            
                <li><a href="../classes/media.lib.stream.html">media.lib.stream</a></li>
            
                <li><a href="../classes/ose.content.html">ose.content</a></li>
            
                <li><a href="../classes/ose.core.html">ose.core</a></li>
            
                <li><a href="../classes/ose.lib.browser.html">ose.lib.browser</a></li>
            
                <li><a href="../classes/ose.lib.cli.html">ose.lib.cli</a></li>
            
                <li><a href="../classes/ose.lib.counter.html">ose.lib.counter</a></li>
            
                <li><a href="../classes/ose.lib.entry.html">ose.lib.entry</a></li>
            
                <li><a href="../classes/ose.lib.entry.link.html">ose.lib.entry.link</a></li>
            
                <li><a href="../classes/ose.lib.entry.master.html">ose.lib.entry.master</a></li>
            
                <li><a href="../classes/ose.lib.entry.slave.html">ose.lib.entry.slave</a></li>
            
                <li><a href="../classes/ose.lib.http.html">ose.lib.http</a></li>
            
                <li><a href="../classes/ose.lib.http.content.html">ose.lib.http.content</a></li>
            
                <li><a href="../classes/ose.lib.kind.html">ose.lib.kind</a></li>
            
                <li><a href="../classes/ose.lib.link.html">ose.lib.link</a></li>
            
                <li><a href="../classes/ose.lib.logger.html">ose.lib.logger</a></li>
            
                <li><a href="../classes/ose.lib.node.html">ose.lib.node</a></li>
            
                <li><a href="../classes/ose.lib.peer.here.html">ose.lib.peer.here</a></li>
            
                <li><a href="../classes/ose.lib.peer.list.html">ose.lib.peer.list</a></li>
            
                <li><a href="../classes/ose.lib.peer.remote.html">ose.lib.peer.remote</a></li>
            
                <li><a href="../classes/ose.lib.peer.rx.html">ose.lib.peer.rx</a></li>
            
                <li><a href="../classes/ose.lib.plugins.html">ose.lib.plugins</a></li>
            
                <li><a href="../classes/ose.lib.scope.html">ose.lib.scope</a></li>
            
                <li><a href="../classes/ose.lib.shard.html">ose.lib.shard</a></li>
            
                <li><a href="../classes/ose.lib.shard.master.html">ose.lib.shard.master</a></li>
            
                <li><a href="../classes/ose.lib.shard.slave.html">ose.lib.shard.slave</a></li>
            
                <li><a href="../classes/ose.lib.space.html">ose.lib.space</a></li>
            
                <li><a href="../classes/ose.lib.space.list.html">ose.lib.space.list</a></li>
            
                <li><a href="../classes/ose.lib.ws.html">ose.lib.ws</a></li>
            
                <li><a href="../classes/ose.lib.ws.browser.html">ose.lib.ws.browser</a></li>
            
                <li><a href="../classes/ose.lib.ws.master.html">ose.lib.ws.master</a></li>
            
                <li><a href="../classes/ose.lib.ws.node.html">ose.lib.ws.node</a></li>
            
                <li><a href="../classes/ose.lib.ws.relay.html">ose.lib.ws.relay</a></li>
            
                <li><a href="../classes/ose.lib.ws.slave.html">ose.lib.ws.slave</a></li>
            
                <li><a href="../classes/ose.wrap.class.html">ose.wrap.class</a></li>
            
                <li><a href="../classes/ose.wrap.common.html">ose.wrap.common</a></li>
            
                <li><a href="../classes/ose.wrap.module.html">ose.wrap.module</a></li>
            
                <li><a href="../classes/ose.wrap.package.html">ose.wrap.package</a></li>
            
                <li><a href="../classes/ose.wrap.singleton.html">ose.wrap.singleton</a></li>
            
                <li><a href="../classes/pa.content.html">pa.content</a></li>
            
                <li><a href="../classes/pa.lib.html">pa.lib</a></li>
            
                <li><a href="../classes/pa.lib.dbus.html">pa.lib.dbus</a></li>
            
                <li><a href="../classes/rpi.content.html">rpi.content</a></li>
            
                <li><a href="../classes/rpi.lib.html">rpi.lib</a></li>
            
                <li><a href="../classes/rpi.lib.camera.html">rpi.lib.camera</a></li>
            
                <li><a href="../classes/rpi.lib.rpi.html">rpi.lib.rpi</a></li>
            
                <li><a href="../classes/videolan.content.html">videolan.content</a></li>
            
                <li><a href="../classes/videolan.lib.html">videolan.lib</a></li>
            
                <li><a href="../classes/videolan.lib.dvblast.html">videolan.lib.dvblast</a></li>
            
                <li><a href="../classes/videolan.lib.dvblast.master.html">videolan.lib.dvblast.master</a></li>
            
                <li><a href="../classes/videolan.lib.vlc.html">videolan.lib.vlc</a></li>
            
                <li><a href="../classes/xorg.content.html">xorg.content</a></li>
            
                <li><a href="../classes/xorg.lib.html">xorg.lib</a></li>
            
                <li><a href="../classes/xorg.lib.xorg.html">xorg.lib.xorg</a></li>
            
                <li><a href="../classes/youtube.content.html">youtube.content</a></li>
            
                <li><a href="../classes/youtube.lib.html">youtube.lib</a></li>
            
                <li><a href="../classes/youtube.lib.video.html">youtube.lib.video</a></li>
            
        </ul>
    </div>
</div>


      </div>

      <div id="main" class="yui3-u">
        <div class="content"><h4>../ose/lib/wrap.js</h4>

<pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

var Ose = require(&#x27;ose&#x27;);
var M;  // This module wrapper; defined during &#x60;setup()&#x60;

/** Doc {{{1
 * @caption Classes and singletons
 * @readme
 *
 *
 * This component facilitates the usage of classes or singletons with
 * simple code sharing and runtime specific behaviour by the browser
 * and Node.js environments. This makes it possible to use
 * prototypal inheritance to create classes and singletons and to mix
 * in modules into class prototypes and singletons.
 *
 * @description
 * ## Module wrapping
 *
 * The creation of classes and singletons is based on the CommonJS
 * Modules spec. Each class or singleton is defined within its own
 * module.
 *
 * To create a class or singleton, you first need to wrap the module
 * containing the class or singleton definition by calling one of the
 * following:
 *
 * - &#x60;Ose.class(module)&#x60;.
 * - &#x60;Ose.singleton(module)&#x60;.
 * - &#x60;Ose.package(module)&#x60;.
 * - &#x60;Ose.module(module)&#x60;.
 *
 * Example:
 *
 *     // Module containing class definiton.
 *     &#x27;use strict&#x27;;
 *
 *     // Require OSE.
 *     var Ose = require(&#x27;ose&#x27;);
 *     // Create and return wrap instance
 *     var M = Ose.class(module);
 *     ...
 *
 * The &#x60;Ose&#x60; variable gives access to global OSE functionalities.  The
 * &#x60;M&#x60; variable contains the module wrapper and gives access to
 * functionalities relative to the module.
 *
 * IMPORTANT:

 * Each time a module is wrapped using &#x60;Ose.class&#x60;, &#x60;Ose.singleton&#x60; or
 * &#x60;Ose.package&#x60; (ie. not &#x60;Ose.module&#x60;), the wrapper adds the &#x60;M&#x60;
 * property to &#x60;module.exports&#x60;. It is not allowed to overwrite this
 * property. The &#x60;M&#x60; property is read-only and non-configurable. It is
 * better not to overload this property.
 *
 * ## Classes
 *
 * A class is a function used as a class constructor with a prototype.
 *
 * To use a class, you need to carry out three steps:
 * 1. Prepare a module containing a class definition.
 * 2. Obtain a class constructor.
 * 3. Create a new object.
 *
 * First, the class needs to be prepared in the module containing the
 * class definition by calling &#x60;Ose.class(module, [constructor],
 * [super])&#x60;. The &#x60;constructor&#x60; is an optional class constructor
 * method. If it is not defined, it gets created automatically. The
 * &#x60;super&#x60; parameter can be &#x60;undefined&#x60;, a class constructor or a
 * class name. It is not possible to inherit from singletons.
 *
 * Example module with class preparation::
 *
 *     // Module &quot;ose/lib/entry&quot;
 *     &#x27;use strict&#x27;;
 *
 *     // Require OSE
 *     var Ose = require(&#x27;ose&#x27;);
 *
 *     // Wrap module and specifies a class with a constructor
 *     // function &#x60;C&#x60; and &quot;EventEmitter&quot; as a super-class.
 *     var M = Ose.class(module, C, &#x27;EventEmitter&#x27;);
 *
 *     // Class constructor
 *     function C(...) {
 *       // Call super constructor
 *       M.super.call(this);
 *       ...
 *     }
 *
 *     // Add properties of the class&#x27; prototype to the &#x60;exports&#x60;
 *     // object:
 *
 *     // Define property.
 *     exports.config = function(name, data) {
 *       ...
 *     };
 *
 *     // Define another property
 *     exports.identify = function() {
 *       return {
 *         space: this.shard.space.name,
 *         shard: this.shard.sid,
 *         entry: this.id
 *       };
 *     };
 *
 *
 * The second step is to obtain a class constructor with its
 * prototype. This step is carried out when the class is first
 * accessed by calling &#x60;M.class(&#x27;ose/lib/entry&#x27;)&#x60;. Multiple calls to
 * &#x60;M.class(&#x27;ose/lib/entry&#x27;)&#x60; return the same, already created
 * class. When called for the first time, the class prototype is
 * created from module exports and optional mixins. If the class has
 * an ancestor, the constructor should usually call the super
 * constructor (see example above). If a class is defined without a
 * constructor, the constructor is created.
 *
 * The last step is to create a new object based on the class.
 *
 * Class usage example:
 *
 *     // Some other module ...
 *     &#x27;use strict&#x27;;
 *
 *     // Require OSE
 *     var Ose = require(&#x27;ose&#x27;);
 *     // Wrap module
 *     var M = Ose.module(module);
 *
 *     // Obtain class constructor (second step).
 *     var Entry = M.class(&#x27;ose/lib/entry&#x27;);
 *
 *     ...
 *
 *     // Create new object as an Entry instance (third step).
 *     entry = new Entry(shard, kind);
 *
 *     ...
 *
 * There is a built-in class named **EventEmitter**. To use this
 * class, pass &#x60;&#x27;EventEmitter&#x27;&#x60; to the &#x60;class()&#x60; method (see the
 * examples above). In the browser environment, the
 * [&quot;wolfy87-eventemitter&quot;](https://github.com/Wolfy87/EventEmitter)
 * package is used.
 *
 * To access the &#x60;module.exports&#x60; object that is wrapped and prepared
 * as a class, call the standard &#x60;require(&#x27;ose/lib/entry&#x27;)&#x60;
 * method. This call returns the original &#x60;module.exports&#x60; object.
 *
 * To extend any class, use the following example:
 *
 *     // Require OSE
 *     var Ose = require(&#x27;ose&#x27;);
 *     // Wrap module
 *     var M = Ose.module(module);
 *
 *     // Obtain Entry class
 *     var Entry = M.class(&#x27;ose/lib/entry&#x27;);
 *
 *     // Add new method to entry class prototype
 *     Entry.prototype.newMethod = function() {...};
 *
 * Changing the prototype of a class alters all its instances and
 * descendants, even those already created.
 *
 * ## Singletons
 *
 * Each singleton is an object. There are two types of singletons. The
 * first initializes itself, and the second is initialized outside the
 * singleton definition.
 *
 * IMPORTANT: Every singleton must always exist in only one instance
 * within a single running instance of OSE. The use of npm can result
 * in mixing multiple installations of packages using singletons
 * within a single OSE instance. This situation must be avoided.
 *
 * Like the creation of a class, the creation of a singleton is a
 * three-step process:
 *
 * 1. Prepare a module containing the singleton&#x27;s definition and
 *    create the singleton
 * 2. Obtain singleton initialization method
 * 3. Initialize and obtain the singleton
 *
 * Example module with self-initializing singleton::
 *
 *     // Require OSE
 *     var Ose = require(&#x27;ose&#x27;);
 *     // Wrap module as a singleton
 *     var M = Ose.singleton(module, I, &#x27;EventEmitter&#x27;);
 *     // Initialization of the singleton
 *     exports = M.init();
 *
 *     // Singleton initialization
 *     function I() {
 *       // Call super constructor
 *       M.super.call(this);
 *       ...
 *     }
 *
 *     // Properties of the singleton are defined in the &#x60;exports&#x60; variable:
 *
 *     exports.identify = function() {
 *       return {
 *         id: this.id
 *       };
 *     };
 *
 *     exports.getId = function() {
 *       return id;
 *     };
 *
 *     ...
 *
 * Example module without singleton self-initialization:
 *
 *     // Require OSE
 *     var Ose = require(&#x27;ose&#x27;);
 *     // Wrap module as a singleton
 *     var M = Ose.singleton(module, I, &#x27;EventEmitter&#x27;);
 *     // Initialization of the singleton
 *     exports = M.exports;
 *     ...
 *
 * Example module with separate singleton initialization:
 *
 *     // Some other module ...
 *     &#x27;use strict&#x27;;
 *
 *     // Require OSE
 *     var Ose = require(&#x27;ose&#x27;);
 *     // Wrap module
 *     var M = Ose.module(module);
 *
 *     ...
 *
 *     // Obtain singleton initialization (second step)
 *     var init = M.singleton(&#x27;ose/lib/peer/list&#x27;);
 *
 *     // Initialize and obtain singleton (third step)
 *     var result = init(arg);
 *
 *     // Or the second and third step together without the init
 *     // variable:
 *     var result = M.singleton(&#x27;ose/lib/peer/list&#x27;)(arg);
 *
 *     ...
 *
 * To access or extend any initialized singleton, use standard &#x60;require&#x60;:
 *
 *     // Module changing singleton.
 *     &#x27;use strict&#x27;;
 *
 *     // Require OSE.
 *     var Ose = require(&#x27;ose&#x27;);
 *
 *     // Obtain singleton.
 *     var result = require(&#x27;ose/lib/id&#x27;);
 *
 *     // Add new method to the singleton.
 *     result.newMethod = function() {...};
 *
 * The singleton can be changed before it is initialized. If this is
 * done, it is possible that the change will be overwritten by mixing
 * other modules during singleton initialization.
 *
 *
 * ## Mixins
 *
 * It is possible to mix another module into a class prototype or
 * singleton. To do that, use the &#x60;append()&#x60; or &#x60;prepend()&#x60; methods of
 * the &#x60;wrap&#x60; object.
 *
 * Example:
 *
 *     // Some module
 *     &#x27;use strict&#x27;;
 *     // Require OSE
 *     var Ose = require(&#x27;ose&#x27;);
 *
 *     // Wrap module
 *     var M = Ose.class(module, C, &#x27;EventEmitter&#x27;);
 *
 *     // Prepend a module
 *     M.prepend(&#x27;someModuleName&#x27;)
 *     // Append a module depending on the runtime.
 *     M.append(&#x27;runtime&#x27;)
 *
 * The &#x60;append()&#x60; or &#x60;prepend()&#x60; methods supports call chaining. Both
 * methods accept a module name or array of module names. Properties
 * to a class prototype or singleton are mixed in the second step of
 * class or singleton creation. Conflicting properties are overwritten
 * in the following order: Last prepended, prepended, module.exports,
 * first appended, appended.
 *
 * It is possible to use the following predefined values as module names:
 * * &#x27;browser&#x27; – If in the browser environment, use the &#x60;browser.js&#x60;
 *    module from the same directory.
 * * &#x27;node&#x27; – If in the Node.js environment, use the &#x60;node.js&#x60;
 *    module from the same directory.
 * * &#x27;runtime&#x27; – Use either the &#x60;browser.js&#x60; or &#x60;node.js&#x60; module
 *    depending on the environment.
 *
 * It is possible to use relative paths as module names.
 *
 * ## Relative paths
 * TODO
 *
 * A class or singleton is identified by its module
 * (e.g. &#x60;ose/lib/entry&#x60;).
 *
 * @aliases class classes singleton singletons eventEmitter super
 *
 * @module ose
 * @submodule ose.wrap
 * @main ose.wrap
 */

// Public {{{1
exports.pdType = {  // {{{2
/**
 * [Property descriptor]
 * (https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/defineProperty)
 * types enumeration.
 */

  none: 0,  // Not yet recognized.
  descriptor: 1,  // Propably a descriptor.
  object: 2,  // Not a property descriptor.
  data: 3,  // Data descriptor.
  accessor: 4,  // Accessor descriptor.
};

exports.setup = function() {  // {{{2
/**
 * Sets up module wrapper of this module
 *
 * @method setup
 */

  M = Ose.module(module);

  Logger = M.class(&#x27;./logger&#x27;);
};

exports.common = object2Def({  // {{{2
/**
 * @caption Common wrapper class
 *
 * @readme
 * Properties common for all wrappers
 *
 * @class ose.wrap.common
 * @type class
 */
  exports: {get: getExports},
  log: {get: getLog},
  consts: {get: getConsts},
  require: moduleRequire,
  package: {get: getPackage},
  class: getClass,
  singleton: getSingleton,
  isSuper: isSuper,
  identify: identify,
  requireChain: requireChain,
});

exports.class = function(m, ctor, sup) {  // {{{2
/**
 * @caption Class wrapper
 *
 * @readme
 * Class defining a class module wrapper.
 *
 * @param m {Object} Module to be wrapped
 * @param [ctor] {Function} Class constructor
 * @param [sup] {Function|String} Super-class
 *
 * @class ose.wrap.class
 * @extends ose.wrap.common
 * @type class
 */

  if (! (m &amp;&amp; (typeof m.exports === &#x27;object&#x27;))) {
    throw Ose.error(this, &#x27;INVALID_ARGS&#x27;, &#x27;Missing module&#x27;, m);
  }

  Object.defineProperty(m.exports, &#x27;M&#x27;, {
    value: this,
    configurable: false,
    enumerable: false,
    writeable: false,
  });

  this.type = &#x27;class&#x27;;
  this.module = m;

  this.setCtor(ctor || undefined);
  this.setSuper(sup || undefined);
};

exports.classProto = object2Def({  // {{{2
  prepend: prepend,
  append: append,
  setSuper: setSuper,
  ctor: {get: getCtor},
  setCtor: setCtor,
});

exports.module = function(m) {  // {{{2
/**
 * @caption Module wrapper
 *
 * @readme
 * Class defining a standard module wrapper.
 *
 * @class ose.wrap.module
 * @extends ose.wrap.common
 * @type class
 */

  this.type = &#x27;module&#x27;;
  this.module = m;
};

exports.moduleProto = object2Def({  // {{{2
});

exports.package = function(m, init) {  // {{{2
/**
 * @caption Package wrapper
 *
 * @readme
 * Class defining a package module wrapper.
 *
 * @param m {Object} Module to be wrapped
 * @param [init] {Function} Init function
 *
 * @class ose.wrap.package
 * @extends ose.wrap.common
 * @type class
 */

  this.type = &#x27;package&#x27;;
  this.module = m;

  this.setInit(init || undefined);
  this.setSuper(undefined);

  // Package singleton can&#x27;t have &#x60;super&#x60; and change exports due to
  // initialization limitations.

  Object.defineProperty(m.exports, &#x27;M&#x27;, {
    value: this,
    configurable: false,
    enumerable: false,
    writeable: false,
  });
};

exports.packageProto = object2Def({  // {{{2
  log: {get: getPackageLog},
  package: {get: getThisPackage},
  prepend: prepend,
  append: append,
  setSuper: setSuper,
  init: {get: getInit},
  setInit: setInit,
  kind: newKind,
  consts: {get: getPackageConsts},
  content: newContent,
  scope: {
    get: getScope,
    set: setScope,
  },
});

exports.singleton = function(m, init, sup) {  // {{{2
/** Singleton
 * @caption Singleton wrapper
 *
 * @readme
 * The class defining a singleton module wrapper.
 *
 * @param m {Object} Module to be wrapped
 * @param [init] {Function} Init function
 * @param [sup] {Function|String} Super-class
 *
 * @class ose.wrap.singleton
 * @extends ose.wrap.common
 * @type class
 */

  this.type = &#x27;singleton&#x27;;
  this.module = m;

  this.setInit(init || undefined);
  this.setSuper(sup || undefined);

  if (this.super) {
    m.exports = Object.create((this.super || Object).prototype);
  }

  Object.defineProperty(m.exports, &#x27;M&#x27;, {
    value: this,
    configurable: false,
    enumerable: false,
    writeable: false,
  });
};

exports.singletonProto = object2Def({  // {{{2
  prepend: prepend,
  append: append,
  setSuper: setSuper,
  init: {get: getInit},
  setInit: setInit,
});

// }}}1
// Private {{{1
var Logger;  // Logger class instance; defined during &#x60;setup()&#x60;  // {{{2

function identify() {  // {{{2
/**
 * Return identification object
 *
 * @result {Object}
 *
 * @method identify
 */

  return {
    type: &#x27;wrap &#x27; + this.type,
    id: this.module.id
  };
};

function getPropType(prop) {  // {{{2
/**
 * Return property descriptor type of &quot;prop&quot;. (exports.pdType.data || exports.pdType.accessor || exports.pdType.object)
 */

  if ((prop === null) || Array.isArray(prop)) {
    return exports.pdType.object;
  }

  var result = exports.pdType.none;

  for (var key in prop) {
    switch (key) {  // Find if &quot;prop&quot; is property descriptor.
    case &#x27;configurable&#x27;:
    case &#x27;enumerable&#x27;:
      if (typeof prop[key] !== &#x27;boolean&#x27;) return exports.pdType.object;
      if (result === exports.pdType.none) result = exports.pdType.descriptor
      break;
    case &#x27;placeholder&#x27;:
      if ((result === exports.pdType.data) || (typeof prop[key] !== &#x27;function&#x27;)) return exports.pdType.object;
      result = exports.pdType.accessor;
      break;
    case &#x27;get&#x27;:
    case &#x27;set&#x27;:
      if ((result === exports.pdType.data) || (typeof prop[key] !== &#x27;function&#x27;)) return exports.pdType.object;
      result = exports.pdType.accessor;
      break;
    case &#x27;writable&#x27;:
      if (typeof prop[key] !== &#x27;boolean&#x27;) return exports.pdType.object;
      // Do not break, continue to next case.
    case &#x27;value&#x27;:
      if (result === exports.pdType.accessor) return exports.pdType.object;
      result = exports.pdType.data;
      break;
    default:  // &quot;prop&quot; is not property descriptor.
      return exports.pdType.object;
    }
  }

  if (result === exports.pdType.none) {
    return exports.pdType.object;  // Empty object is not property descriptor.
  }

  return result;
};

function extend2Proto(m, extend, proto, keep) {  // {{{2
  if (! extend) return;

  var def = {};

  extend2Def(m, extend, def);

  for (var key in def) {
    if ((key in proto) &amp;&amp; keep) continue;

    Object.defineProperty(proto, key, def[key]);
  }
};

function extend2Def(m, extend, dst) {  // {{{2
  if (! extend) return;

//  console.log(&#x27;EXTEND 2 DEF&#x27;, extend);

  switch (typeof extend) {
  case &#x27;function&#x27;:
    extend(m, dst);
    return;
  case &#x27;string&#x27;:
    extend2Def(m, m.require(extend), dst);
    return;
  case &#x27;object&#x27;:
    if (Array.isArray(extend)) {
      for (var i = 0; i &lt; extend.length; i++) {
        extend2Def(m, extend[i], dst);
      }
      return;
    }

    object2Def(extend, dst);
    return;
  }

  throw Ose.error(&#x27;invalidArgs&#x27;, arguments);
};

function object2Def(src, dst) {  // {{{2
/**
 * Copy and convert property definitions from &quot;src&quot; class definition
 * to &quot;dst&quot; class definition.
 *
 * @param src {Object} Source object
 * @param dst {Object} Destination definition object
 *
 * @return {Object} &#x60;dst&#x60;
 *
 * @method object2Def
 * @private
 */

  if (! dst) dst = {};
  if (! src) return dst;

  Object.getOwnPropertyNames(src).forEach(function(key) {  // Enumerate all own properties of &quot;src&quot;.
    var val = src[key];

    switch (typeof val) {
    case &#x27;boolean&#x27;:
    case &#x27;number&#x27;:
    case &#x27;string&#x27;:
    case &#x27;null&#x27;:
    case &#x27;undefined&#x27;:
      dst[key] = {
        configurable: false,
        enumerable: false,
        value: val,
        writable: true,
      };

      break;
    case &#x27;function&#x27;:  // {{{3
      dst[key] = {
        configurable: false,
        enumerable: false,
        value: val,
        writable: true,
      };

      break;
    case &#x27;object&#x27;:  // {{{3
      switch (getPropType(val)) {
      case exports.pdType.object:  // &quot;val&quot; is not property descriptor.
        dst[key] = {
          configurable: false,
          enumerable: false,
          value: val,
          writable: true,
        };

        break;
      case exports.pdType.data:  // &quot;val&quot; is data property descriptor.
        dst[key] = {
          configurable: val.configurable || false,
          enumerable: val.enumerable || false,
          value: val.value,
          writable: &#x27;writable&#x27; in val ? val.writable : true,
        };

        break;
      case exports.pdType.accessor:  // &quot;val&quot; is accessor property descriptor.
        dst[key] = {
          configurable: val.configurable || false,
          enumerable: val.enumerable || false,
          get: val.get || undefined,
          set: val.set || undefined,
        };

        break;
      default:
        throw Ose.error(&#x27;unknownPropertyDescriptorType&#x27;, val);
      }

      break;
    default:  // {{{3
      throw Ose.error(&#x27;unknownPropertyType&#x27;, val);
    // }}}3
    }
  });

  return dst;
};

function newCtor(sup) {  // {{{2
  return function() {
    sup.apply(this, arguments);
  }
};

function getSingleton(id) {  // {{{2
//  console.log(&#x27;OSE SINGLETON&#x27;, id);

  if (arguments.length === 0) {
    return this.init;
  }

  var m = id ? this.module.require(id) : this.module;

  if (m.M &amp;&amp; (&#x27;init&#x27; in m.M)) {
    return m.M.init;
  }

  throw Ose.error(this, &#x27;notSingleton&#x27;, id);
};

function getClass(name) {  // {{{2
  if (arguments.length === 0) {
    return this.ctor;
  }

  if (name in Ose.classes) {
    return Ose.classes[name];
  }

  var u = this.module.require(name);

  if (u.M &amp;&amp; (&#x27;ctor&#x27; in u.M)) {
    return u.M.ctor;
  }

  throw Ose.error(this, &#x27;notClass&#x27;, name);
};

function getExports() {  // {{{2
  return this.module.exports;
};

function getInit() {  // {{{2
  if (&#x27;_init&#x27; in this) {
    throw Ose.error(this, &#x27;alreadyInitialized&#x27;);
  }

  this._init = init;

  var e = this.module.exports;

  if (this.prepends) {
    extend2Proto(this, this.prepends, e, true);
    delete this.prepends;
  }

  if (this.module.loaded) {
    if (this.appends) {
      extend2Proto(this, this.appends, e);
      delete this.appends;
    }
  } else {
    this.timeout = setTimeout(finish.bind(this), 0);
  }

  var that = this;

  return this._init;

  function init() {  // {{{3
    that._init = done;
    if (that.timeout) {
      clearTimeout(that.timeout);
      finish();
    }

    var result;
    if (that.__init) {
      result = that.__init.apply(e, arguments);
    } else if (that.super) {
      result = that.super.apply(e, arguments);
    }

    if (result === undefined) {
      return e;
    }

    return result;
  }

  function done() {  // {{{3
    throw Ose.error(that, &#x27;alreadyInitialized&#x27;);
  }

  function finish() {  // {{{3
    delete that.timeout;

    if (that.appends) {
      extend2Proto(that, that.appends, e);
      delete that.appends;
    }
  }

  // }}}3
};

function setInit(val) {  // {{{2
  if ((&#x27;__init&#x27; in this) || (&#x27;_init&#x27; in this)) {
    throw Ose.error(this, &#x27;duplicitInit&#x27;, val);
  }

  switch (typeof val) {
  case &#x27;undefined&#x27;:
  case &#x27;function&#x27;:
    this.__init = val;
    return this;
  }

  throw Ose.error(this, &#x27;invalidArgs&#x27;, arguments);
}

function getCtor() {  // {{{2
  if (&#x27;_ctor&#x27; in this) {
    return this._ctor;
  }

  if (! (&#x27;__ctor&#x27; in this)) {
    throw Ose.error(this, &#x27;invalidClass&#x27;);
  }

  if (this.__ctor) {
    this._ctor = this.__ctor;
  } else {
    if (this.super) {
      this._ctor = newCtor(this.super);
    } else {
      this._ctor = new Function();
    }
  }

  delete this.__ctor;

  var def = {};
  if (this.prepends) {
    extend2Def(this, this.prepends, def);
    delete this.prepends;
  }

  if (this.module.loaded) {
    extend2Def(this, this.module.exports, def);
    if (this.appends) {
      extend2Def(this, this.appends, def);
      delete this.appends;
    }
  } else {
    this.timeout = setTimeout(finish.bind(this), 0);
  }

  this._ctor.prototype = Object.create(
    (this.super || Object).prototype,
    def
  );

//  console.log(&#x27;CTOR PROTOTYPE DEF&#x27;, this.module.loaded, def);

  return this._ctor;

  function finish() {
    delete this.timeout;
    extend2Proto(this.module.exports, this._ctor.prototype);

    if (this.appends) {
      extend2Proto(this, this.appends, this._ctor.prototype);
      delete this.appends;
    }
  }
}

function setCtor(val) {  // {{{2
  if ((&#x27;__ctor&#x27; in this) || (&#x27;_ctor&#x27; in this)) {
    throw Ose.error(this, &#x27;duplicitCtor&#x27;, val);
  }

  switch (typeof val) {
  case &#x27;undefined&#x27;:
  case &#x27;function&#x27;:
    this.__ctor = val;
    return this;
  }

  throw Ose.error(this, &#x27;invalidArgs&#x27;, arguments);
}

function setSuper(val) {  // {{{2
  if ((&#x27;_ctor&#x27; in this) || (&#x27;_init&#x27; in this)) {
    throw Ose.error(this, &#x27;alreadyInitialized&#x27;);
  }

  if (&#x27;super&#x27; in this) {
    throw Ose.error(this, &#x27;duplicitSuper&#x27;, val);
  }

  switch (typeof val) {
  case &#x27;string&#x27;:
    this.super = this.class(val);
    return this;
  case &#x27;object&#x27;:
    if (val) break;
  case &#x27;null&#x27;:
  case &#x27;undefined&#x27;:
    this.super = undefined;
    return this;
  case &#x27;function&#x27;:
    this.super = val;
    return this;
  }

  throw Ose.error(this, &#x27;invalidArgs&#x27;, arguments);
}

function getConsts() {  // {{{2
  return this.package.consts;
};

function getPackageConsts() {  // {{{2
  if (this._consts) {
    return this._consts;
  }

  return this._consts = {};
}

function getLog() {  // {{{2
  if (this._log) {
    return this._log;
  }

  return this._log = this.package.log;
};

function getPackageLog() {  // {{{2
  if (this._log) {
    return this._log;
  }

  return this._log = new Logger(this.name);
}

function getPackage() {  // {{{2
  if (this._package) {
    return this._package;
  }

  var name = this.module.filename.split(&#x27;/&#x27;);
  name.pop();
  while (name.length) {
//    console.log(&#x27;GET PACKAGE&#x27;, name);
    switch (name[name.length - 1]) {
    case &#x27;&#x27;:
    case &#x27;lib&#x27;:
      break;
    default:
      try {
        var m = this.module.require(name.join(&#x27;/&#x27;));

//        console.log(&#x27;REQUIRE&#x27;, m.M &amp;&amp; m.M.type);

        if (m &amp;&amp; m.M &amp;&amp; (m.M.type === &#x27;package&#x27;)) {
          return this._package = m.M;
        }
      } catch (e) {
        if (e.code !== &#x27;MODULE_NOT_FOUND&#x27;) throw e;
      }
    }

    name.pop();
  }

  return null;
}

function getThisPackage() {  // {{{2
  return this;
};

function prepend(extend) {  // {{{2
/**
 * TODO
 *
 * @param extend {String|Array} Extension to be mixed into wrapped class or singleton.
 *
 * @method prepend
 */

  if ((&#x27;_ctor&#x27; in this) || (&#x27;_init&#x27; in this)) {
    throw Ose.error(this, &#x27;alreadyCreated&#x27;, extend);
  }

  switch (typeof extend) {
  case &#x27;function&#x27;:
  case &#x27;string&#x27;:
    extend = [extend];
    break;
  case &#x27;array&#x27;:
    break;
  default:
    throw Ose.error(this, &#x27;invalidArgs&#x27;, arguments);
  }

  if (this.prepends) {
    this.prepends = union(this.prepends, extend);
  } else {
    this.prepends = extend;
  }

  return this;
};

function append(extend) {  // {{{2
/**
 *
 * @param extend {object} TODO
 *
 * @method
 */

  if ((&#x27;_ctor&#x27; in this) || (&#x27;_init&#x27; in this)) {
    throw Ose.error(this, &#x27;alreadyCreated&#x27;, extend);
  }

  switch (typeof extend) {
  case &#x27;function&#x27;:
  case &#x27;string&#x27;:
    extend = [extend];
    break;
  case &#x27;array&#x27;:
    break;
  default:
    throw Ose.error(&#x27;invalidArgs&#x27;, arguments);
  }

  if (this.appends) {
    this.appends = union(this.appends, extend);
  } else {
    this.appends = extend;
  }

  return this;
};

function isSuper(sup, desc) {  // {{{2
/**
 * Tests whether &#x60;desc&#x60; is descendant of &#x60;sup&#x60;. When called with one argument, this argument is assigned to &#x60;desc&#x60; and super is &#x60;this.ctor&#x60;
 *
 * @param sup {String|Object|Function} Super
 * @param desc {String|Object|Function} Descendant
 *
 * @return {Boolean} isSuper
 *
 * @method isSuper
 */

  // console.log(&#x27;IS SUPER 1&#x27;, sup, desc);

  if (arguments.length === 1) {
    desc = sup;
    sup = this.ctor;
  }

  if (! (sup &amp;&amp; desc)) return false;

  switch (typeof sup) {
  case &#x27;string&#x27;:
    sup = this.class(sup);
    break;
  case &#x27;object&#x27;:
    sup = sup.constructor;
    break;
  case &#x27;function&#x27;:
    break;
  default:
    throw Ose.error(&#x27;invalidArgs&#x27;, arguments);
  }

  switch (typeof desc) {
  case &#x27;string&#x27;:
    return this.class(desc).prototype instanceof sup;
  case &#x27;object&#x27;:
    return desc instanceof sup;
  case &#x27;function&#x27;:
    return desc.prototype instanceof sup;
  default:
    throw Ose.error(&#x27;invalidArgs&#x27;, arguments);
  }
};

function moduleRequire(id) {  // {{{2
  switch (id) {
  case null:
  case undefined:
    return undefined;
  case &#x27;runtime&#x27;:
    return this.module.require(&#x27;./&#x27; + Ose.runtime);
    break;
  case &#x27;node&#x27;:
  case &#x27;browser&#x27;:
    if (id !== Ose.runtime) {
      return undefined;
    }

    return this.module.require(&#x27;./&#x27; + id);
  }
};

function newKind(path, name) {  // {{{2
  if (! (&#x27;_scope&#x27; in this)) {
    throw Ose.error(this, &#x27;missingScope&#x27;);
  }

  this.singleton(path)(this.scope, name);
};

function newContent() {  // {{{2
  if (Ose.runtime === &#x27;browser&#x27;) return;

  this.singleton(this.path + &#x27;/content&#x27;)(this.path, this.name);
};

function getScope() {  // {{{2
  return this._scope;
};

function setScope(scope) {  // {{{2
  switch (typeof scope) {
  case &#x27;string&#x27;:
    this._scope = Ose.scope(scope);
    return;
  case &#x27;object&#x27;:
    this._scope = scope;
    return;
  }

  throw Ose.error(this, &#x27;invalidArgs&#x27;, arguments);
};

function requireChain(id) {  // {{{2
  var m = this;
  while (m) {
    try {
      return m.module.require(id);
    } catch (err) {
      if (err.code !== &#x27;MODULE_NOT_FOUND&#x27;) {
        throw err;
      }
    }

    switch (m.type) {
    case &#x27;package&#x27;:
    case &#x27;singleton&#x27;:
    case &#x27;class&#x27;:
      m = m.super &amp;&amp; m.super.prototype.M;
      break;
    case &#x27;module&#x27;:
      return m.module.require(id);
    default:
      throw Ose.error(this, &#x27;invalidModuleType&#x27;, m.type);
    }
  }

  var err = Ose.error(this, id);
  err.code = &#x27;MODULE_NOT_FOUND&#x27;;
  throw err;
};

// }}}1

</pre>

</div>
      </div>

    </div>
  </div>
  <script src="../assets/vendor/prettify/prettify-min.js"></script>
  <script>prettyPrint();</script>
  <script src="../assets/js/yui-prettify.js"></script>
  <!--script src="../assets/js/tabs.js"></script-->
  <script src="../assets/js/ose.js"></script>
</body>
</html>
